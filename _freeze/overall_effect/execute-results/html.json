{
  "hash": "748713a1921d2a8a5d8e6803f3d47cef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Overall effect\"\n---\n\n\n\n\nAfter estimating our effect sizes, we now run a **multilevel, intercept-only meta-analysis** using the $\\text{rma.mv}$ function in the `metafor` package to estimate the **overall mean effect** of the experimental treatment (music exposure) across all independent cohorts and studies in the dataset.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndb <- readr::read_csv(here(\"data\",\"db_effect_sizes.csv\")) %>%\nmutate(across(c(C_n, Ex_n, C_mean, Ex_mean, C_SE, Ex_SE, C_SD, Ex_SD), as.numeric))%>%\n  mutate(across(where(is.character), as.factor))\n```\n:::\n\n\n\n\n::: callout-note\nVariable definitions:\n\n| Variable Name | Definition |\n|:---|:---|\n| **`ES_ID`** | Unique row identifier for each $\\text{lnRR}$ effect size. |\n| **`Study_ID`** | Identifier for the primary research paper. |\n| **`Cohort_ID`** | Identifier for specific experimental groups within a study (combination of Study_ID and Experiment_ID). |\n:::\n\n## Variance-covariance matrix\n\nAfter loading the data containing our calculated effect sizes (lnRR and lnRR_var), we create a variance-covariance matrix to account for dependencies among effect sizes from the same cohort (i.e., correlated outcomes).\n\n::: callout-tip\nwhen multiple effect sizes originate from the same source (e.g., several different outcomes measured on the same animals within one study cohort), they are inherently correlated. If we treat them as fully independent, our model would underestimate the true standard errors and potentially inflate the statistical significance of our findings. The $\\text{VCV}$ matrix resolves this by explicitly modeling the covariance between these related effect sizes.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nVCV <- metafor::vcalc(\n  vi = lnRR_var,\n  cluster = Cohort_ID, # The clustering variable (Study_ID + Ex_ID)\n  obs = ES_ID,         # The unique observation/effect size ID\n  rho = 0.5,           # Assumed correlation between outcomes from the same cohort\n  data = db \n)\n```\n:::\n\n\n\n\n## Multilevel \"Intercept only\" meta-analytic model\n\nWe then fit a multilevel meta-analytic model with random effects for Study_ID, Cohort_ID, and ES_ID to estimate the overall mean effect size.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nma_all <- rma.mv(yi = lnRR,\n                  V = VCV, \n                  random = list(~1 | Study_ID,\n                                ~1 | Cohort_ID,\n                                ~1 | ES_ID,\n                                ~1 | Strain),\n                  test = \"t\",\n                  method = \"REML\", \n                  sparse = TRUE,\n                  data = db)\n\nsummary(ma_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nMultivariate Meta-Analysis Model (k = 299; method: REML)\n\n   logLik   Deviance        AIC        BIC       AICc   \n-250.0190   500.0379   510.0379   528.5234   510.2434   \n\nVariance Components:\n\n            estim    sqrt  nlvls  fixed     factor \nsigma^2.1  0.0244  0.1561     20     no   Study_ID \nsigma^2.2  0.0244  0.1561     20     no  Cohort_ID \nsigma^2.3  0.2173  0.4662    299     no      ES_ID \nsigma^2.4  0.0000  0.0001      6     no     Strain \n\nTest for Heterogeneity:\nQ(df = 298) = 5721.7148, p-val < .0001\n\nModel Results:\n\nestimate      se    tval   df    pval   ci.lb   ci.ub     \n  0.2058  0.0654  3.1485  298  0.0018  0.0772  0.3344  ** \n\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\nWe can extract the $I^2$ statistic to quantify the proportion of total variability in effect sizes that is due to heterogeneity rather than sampling error.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\norchaRd::i2_ml(ma_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    I2_Total  I2_Study_ID I2_Cohort_ID     I2_ES_ID    I2_Strain \n9.634999e+01 8.828717e+00 8.828711e+00 7.869257e+01 1.133087e-06 \n```\n\n\n:::\n:::\n\n\n\n\nWe can also extract the model's $R^2$ value to assess the proportion of variance explained by the model.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr2 <- round(r2_ml(ma_all), 4)\nr2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   R2_marginal R2_conditional \n        0.0000         0.1833 \n```\n\n\n:::\n:::\n\n\n\n\nInterestingly, `Study_ID` and `Cohort_ID` are accounting for a similar portion of the total variance. So, we drop `Cohort_ID` from the random effects structure and refit the model to see if it improves parsimony without sacrificing model fit. \\## Model simplification\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nma_all <- rma.mv(yi = lnRR,\n                  V = VCV, \n                  random = list(~1 | Study_ID,\n                                ~1 | ES_ID,\n                                ~1 | Strain),\n                  test = \"t\",\n                  method = \"REML\", \n                  sparse = TRUE,\n                  data = db)\n\nsummary(ma_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nMultivariate Meta-Analysis Model (k = 299; method: REML)\n\n   logLik   Deviance        AIC        BIC       AICc   \n-250.0190   500.0379   508.0379   522.8263   508.1744   \n\nVariance Components:\n\n            estim    sqrt  nlvls  fixed    factor \nsigma^2.1  0.0488  0.2208     20     no  Study_ID \nsigma^2.2  0.2173  0.4662    299     no     ES_ID \nsigma^2.3  0.0000  0.0001      6     no    Strain \n\nTest for Heterogeneity:\nQ(df = 298) = 5721.7148, p-val < .0001\n\nModel Results:\n\nestimate      se    tval   df    pval   ci.lb   ci.ub     \n  0.2058  0.0654  3.1485  298  0.0018  0.0772  0.3344  ** \n\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norchaRd::i2_ml(ma_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    I2_Total  I2_Study_ID     I2_ES_ID    I2_Strain \n9.634999e+01 1.765743e+01 7.869256e+01 9.771152e-07 \n```\n\n\n:::\n:::\n\n\n\n\nAs we can see, we achieve a similar fit with a more parsimonious model.\n\nFinally, we can visualize the overall effect size estimate using an orchard plot from the `orchaRd` package.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\norchard_plot(ma_all,\n              group = \"Study_ID\",\n              xlab = \"log response ratio (lnRR)\", \n              angle = 45) + \n              scale_x_discrete(labels = c(\"Overall effect\")) \n```\n\n::: {.cell-output-display}\n![](overall_effect_files/figure-html/orchard_plot-1.png){width=576}\n:::\n:::\n",
    "supporting": [
      "overall_effect_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}