<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Effect size calculation – Music exposure reduces anxiety- and depression-like behavior in rodents: a systematic review and multilevel meta-analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./overall_effect.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c8351a6700bf180518d6485ea8e2e68e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-01ab2c8909333120ec6c01cbceee758c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-c8351a6700bf180518d6485ea8e2e68e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Music exposure reduces anxiety- and depression-like behavior in rodents: a systematic review and multilevel meta-analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Santiago-0rtega/Music_on_anxiety_depression_meta_analysis"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://osf.io/mv78t"> 
<span class="menu-text">OSF</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://doi.org/XXXXX"> 
<span class="menu-text">Paper</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./effect_size_calculation.html"><span class="chapter-title">Effect size calculation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Online supplementary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./effect_size_calculation.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Effect size calculation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overall_effect.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Overall effects</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./uni_moderators.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Uni-moderators</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./publication_bias.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Publication bias</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./leave_one_out.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">leave-one-out</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./main_figures.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Code for figures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Alluvial.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Alluvial plot</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#lnrr" id="toc-lnrr" class="nav-link active" data-scroll-target="#lnrr">lnRR</a></li>
  <li><a href="#lnvr" id="toc-lnvr" class="nav-link" data-scroll-target="#lnvr">lnVR</a></li>
  <li><a href="#lncvr" id="toc-lncvr" class="nav-link" data-scroll-target="#lncvr">lnCVR</a></li>
  <li><a href="#functions-and-computation" id="toc-functions-and-computation" class="nav-link" data-scroll-target="#functions-and-computation">Functions and computation</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Effect size calculation</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               DT,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               dtplyr,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               here, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               knitr,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               tidyverse,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>               patchwork,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>               metafor,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>               orchaRd, kableExtra</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>               )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="lnrr" class="level1">
<h1>lnRR</h1>
<p>This section estimates the log response ratio (lnRR), which quantifies whether music exposure changes the average level of a behavioral outcome relative to controls.</p>
<div class="card">
<p>The lnRR is defined as: <span class="math display">\[
\begin{equation} \label{eq:lnRR}
\ln RR =
\ln\left(\frac{M_T}{M_C}\right)
+
\frac{1}{2}
\left(
\frac{SD_T^2}{N_T M_T^2}
-
\frac{SD_C^2}{N_C M_C^2}
\right),
\end{equation}
\]</span> where <span class="math inline">\(M_T\)</span> and <span class="math inline">\(M_C\)</span> denote the sample means, <span class="math inline">\(SD_T\)</span> and <span class="math inline">\(SD_C\)</span> the sample standard deviations, and <span class="math inline">\(N_T\)</span> and <span class="math inline">\(N_C\)</span> the sample sizes of the music-exposed (treatment) and control groups, respectively.</p>
</div>
<p>Negative lnRR values indicate reductions in anxiety- or depression-like behavior under music exposure (after directional harmonization). Specifically, we harmonize outcome direction using the variable <code>Higher_better</code> such that lnRR is multiplied by <span class="math inline">\(−1\)</span> when higher values represent improved outcomes (e.g., more exploration or less immobility).</p>
</section>
<section id="lnvr" class="level1">
<h1>lnVR</h1>
<p>Here we estimate the log variability ratio (lnVR), which quantifies whether music exposure changes the dispersion (standard deviation) of behavioral outcomes relative to controls.</p>
<div class="card">
<p>lnVR is defined as <span class="math display">\[
\ln VR = \ln\left(\frac{SD_T}{SD_C}\right) + \frac{1}{2}\left(\frac{1}{N_T-1}-\frac{1}{N_C-1}\right)
\]</span> where <span class="math inline">\(SD\)</span> is the standard deviation and <span class="math inline">\(N\)</span> is the sample size for treatment (<span class="math inline">\(T\)</span>) and control (<span class="math inline">\(C\)</span>) groups.</p>
</div>
<p>A positive lnVR indicates higher variability under music exposure (less consistent responses), whereas a negative lnVR indicates lower variability (more consistent responses).</p>
</section>
<section id="lncvr" class="level1">
<h1>lnCVR</h1>
<p>Finally, we estimate the log coefficient of variation ratio (lnCVR). Whereas lnVR compares standard deviations directly, lnCVR compares relative variability, thereby accounting for differences in group means. This is useful when variability is expected to scale with the mean.</p>
<div class="card">
<p>lnCVR is defined as</p>
<p><span class="math display">\[
\ln \text{CVR} = \ln \left( \frac{CV_T}{CV_C} \right) + \frac{1}{2} \left( \frac{1}{n_T - 1} - \frac{1}{n_C - 1} \right) - \frac{1}{2} \left( \frac{s_T^2}{n_T M_T^2} - \frac{s_C^2}{n_C M_C^2} \right)
\]</span></p>
<p>where <span class="math inline">\(M\)</span>, <span class="math inline">\(SD\)</span>, amd <span class="math inline">\(n\)</span> are the sample mean, standard deviation, and sample size for treatment (<span class="math inline">\(T\)</span>) and control (<span class="math inline">\(C\)</span>) groups, respectively. <span class="math inline">\(\text{with} \quad CV = \frac{SD}{M}\)</span></p>
</div>
<p>A positive lnCVR indicates higher relative variability (higher <span class="math inline">\(CV\)</span>) under music exposure, whereas a negative lnCVR indicates lower relative variability (lower <span class="math inline">\(CV\)</span>).</p>
</section>
<section id="functions-and-computation" class="level1">
<h1>Functions and computation</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Shared workflow details for effect-size functions
</div>
</div>
<div class="callout-body-container callout-body">
<p>All three effect-size functions (<code>calculate_lnRR()</code>, <code>calculate_lnVR()</code>, <code>calculate_lnCVR()</code>) follow the same general preprocessing and design-handling logic to ensure numerical stability and consistent treatment of study designs.</p>
<section id="data-type-handling" class="level2">
<h2 class="anchored" data-anchor-id="data-type-handling">Data-type handling</h2>
<ul>
<li>Outcomes are categorized via <code>Data_type</code>.</li>
<li>Proportional outcomes (<code>Data_type == "percentage"</code>) are treated separately for lnRR (variance-stabilizing transformation), and excluded from lnVR and lnCVR because bounded scales induce a mechanical mean–variance relationship that complicates biological interpretation of variability metrics.</li>
</ul>
</section>
<section id="boundary-corrections-and-numerical-safeguards" class="level2">
<h2 class="anchored" data-anchor-id="boundary-corrections-and-numerical-safeguards">Boundary corrections and numerical safeguards</h2>
<p>To prevent undefined operations (e.g., log(0) or division by zero), the functions apply small boundary corrections when needed:</p>
<ul>
<li><p>means reported as exactly 0 are shifted to a small positive constant (e.g., 0.005),</p></li>
<li><p>standard deviations reported as 0 are shifted to small positive constants (e.g., 0.01 / 0.05).</p></li>
</ul>
<p>These adjustments are strictly pragmatic and affect only edge cases where effect sizes would otherwise be undefined.</p>
</section>
<section id="standard-deviation-imputation-when-required" class="level2">
<h2 class="anchored" data-anchor-id="standard-deviation-imputation-when-required">Standard deviation imputation (when required)</h2>
<p>When studies report standard errors but not standard deviations, SDs are derived using: <span class="math display">\[
\text{SD} = \text{SE} \times \sqrt{N}
\]</span> This imputation is performed during data preprocessing (before effect size computation) so that all effect-size functions operate on complete <code>SD</code> fields.</p>
</section>
<section id="independent-vs-dependent-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="independent-vs-dependent-comparisons">Independent vs dependent comparisons</h2>
<p>Each function accounts for whether treatment and control groups are independent (different animals) or dependent (paired / repeated measures), using <code>Comparison_structure</code>:</p>
<ul>
<li><p>Independent: standard two-group estimators are used.</p></li>
<li><p>Dependent: correlated-sample estimators are used, and sampling variances include the covariance term implied by within-subject correlation.</p></li>
</ul>
<p>When correlation is not reported, we assume a moderate within-subject correlation of <span class="math inline">\(r = 0.5\)</span>, consistent across lnRR, lnVR, and lnCVR, to enable variance estimation for paired designs.</p>
</section>
<section id="direction-harmonization" class="level2">
<h2 class="anchored" data-anchor-id="direction-harmonization">Direction harmonization</h2>
<p>Direction harmonization (multiplying by <span class="math inline">\(−1\)</span> using <code>Higher_better</code>) is applied only to lnRR, because it represents a mean shift with a natural “beneficial vs harmful” polarity after standardizing outcome direction. Variability metrics (lnVR and lnCVR) are interpreted directly (positive = more variable under music; negative = less variable), since dispersion is not inherently “good” or “bad” across outcomes.</p>
</section>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">".."</span>,<span class="st">"data"</span>,<span class="st">"db251124.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(C_n, Ex_n, C_mean, Ex_mean, C_SE, Ex_SE, C_SD, Ex_SD), as.numeric),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Comparison_structure =</span> <span class="fu">as.character</span>(Comparison_structure),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Higher_better =</span> <span class="fu">as.character</span>(Higher_better)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Impute SD when missing but SE available: SD = SE * sqrt(n)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">C_SD  =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(C_SD)  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(C_SE)  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(C_n),  C_SE  <span class="sc">*</span> <span class="fu">sqrt</span>(C_n),  C_SD),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ex_SD =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Ex_SD) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Ex_SE) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Ex_n), Ex_SE <span class="sc">*</span> <span class="fu">sqrt</span>(Ex_n), Ex_SD)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Helpful unique cohort identifier (optional)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cohort_ID =</span> <span class="fu">paste</span>(Study_ID, <span class="st">"Ex-ID"</span>, <span class="at">sep =</span> <span class="st">"_"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>How to handle zeros in means and SDs?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some studies report means or standard deviations equal to zero (often due to rounding, reporting limits, or zero-inflated measures). Because our effect sizes involve log ratios (e.g., lnRR, lnVR, lnCVR), exact zeros can produce undefined values (e.g., log(0) or division by zero). To avoid dropping these effect sizes, we apply a small continuity correction that is conservative and grounded in the observed data.</p>
<p>This callout contains (i) a continuity-correction helper used during effect-size calculation and (ii) a small audit routine that verifies exactly which rows were modified.</p>
<ol type="1">
<li><p><code>min_pos()</code>: find the smallest non-zero value. This is used to define a “biologically realistic” continuity correction based on observed data rather than an arbitrary constant.</p></li>
<li><p><code>apply_continuity_within_group()</code>: continuity correction within outcome strata, separately for each group (control or experimental). This function prevents undefined computations (e.g., log(0) or division by 0)</p></li>
</ol>
<section id="step-by-step" class="level2 card">
<h2 class="anchored" data-anchor-id="step-by-step">Step-by-step</h2>
<ol type="1">
<li>Standardize types</li>
</ol>
<p>Converts Data_type to lowercase.</p>
<p>Coerces <code>C_mean</code>, <code>Ex_mean</code>, <code>C_SD</code>, and <code>Ex_SD</code> to numeric to ensure reliable comparisons to zero</p>
<ol start="2" type="1">
<li>Define “local” minima within strata</li>
</ol>
<p>The dataset is grouped by strata (default: <code>Assay_type</code> × <code>Measurment_variable</code> × <code>Data_type</code>).</p>
<p>Within each stratum, it computes:</p>
<p><code>min_C_mean_pos</code>: smallest positive control mean</p>
<p><code>min_Ex_mean_pos</code>: smallest positive experimental mean</p>
<p>These are computed separately for control and experimental groups</p>
<ol start="3" type="1">
<li>Compute continuity constants (epsilons)</li>
</ol>
<p>For each stratum:</p>
<p><code>eps_C_mean</code> = <code>mult × min_C_mean_pos</code></p>
<p><code>eps_Ex_mean</code> = <code>mult × min_Ex_mean_pos</code></p>
<p>With mult = <span class="math inline">\(0.9\)</span>, the replacement value is slightly smaller than the smallest observed non-zero value in that stratum, keeping it within a plausible range.</p>
<ol start="4" type="1">
<li>Apply corrections</li>
</ol>
<p>If <code>C_mean == 0</code>, replace with <code>eps_C_mean</code></p>
<p>If <code>Ex_mean == 0</code>, replace with <code>eps_Ex_mean</code> This ensures means are non-zero where required</p>
</section>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>min_pos <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[<span class="fu">is.finite</span>(x) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x) <span class="sc">&amp;</span> x <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(x)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>apply_continuity_within_group <span class="ot">&lt;-</span> <span class="cf">function</span>(dt,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">mult =</span> <span class="fl">0.9</span>) {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(<span class="fu">c</span>(C_mean, Ex_mean, C_SD, Ex_SD), <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  mins <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(strata))) <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_C_mean_pos  =</span> <span class="fu">min_pos</span>(C_mean),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_Ex_mean_pos =</span> <span class="fu">min_pos</span>(Ex_mean),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  g_C_mean  <span class="ot">&lt;-</span> <span class="fu">min_pos</span>(dt<span class="sc">$</span>C_mean)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  g_Ex_mean <span class="ot">&lt;-</span> <span class="fu">min_pos</span>(dt<span class="sc">$</span>Ex_mean)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(mins, <span class="at">by =</span> strata) <span class="sc">%&gt;%</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">eps_C_mean  =</span> mult <span class="sc">*</span> <span class="fu">coalesce</span>(min_C_mean_pos,  g_C_mean),</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">eps_Ex_mean =</span> mult <span class="sc">*</span> <span class="fu">coalesce</span>(min_Ex_mean_pos, g_Ex_mean),</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Mean correction (within-group)</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_mean  =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(C_mean)  <span class="sc">&amp;</span> C_mean <span class="sc">==</span> <span class="dv">0</span>,  eps_C_mean,  C_mean),</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_mean =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ex_mean) <span class="sc">&amp;</span> Ex_mean <span class="sc">==</span> <span class="dv">0</span>, eps_Ex_mean, Ex_mean),</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># SD rule if SD == 0, set to 0.05</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_SD  =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(C_SD)  <span class="sc">&amp;</span> C_SD <span class="sc">==</span> <span class="dv">0</span>,  <span class="fl">0.05</span>, C_SD),</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_SD =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ex_SD) <span class="sc">&amp;</span> Ex_SD <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">0.05</span>, Ex_SD)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>min_C_mean_pos, <span class="sc">-</span>min_Ex_mean_pos, <span class="sc">-</span>eps_C_mean, <span class="sc">-</span>eps_Ex_mean)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<ol start="3" type="1">
<li>Audit chunk: verify exactly which rows changed</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>db_before <span class="ot">&lt;-</span> db <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(C_mean, Ex_mean, C_SD, Ex_SD), <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    ES_ID, Study_ID, Cohort_ID, Assay_type, Measurment_variable, Data_type,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    C_mean, Ex_mean, C_SD, Ex_SD</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>db_after <span class="ot">&lt;-</span> <span class="fu">apply_continuity_within_group</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  db_before,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">mult =</span> <span class="fl">0.9</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ES_ID, C_mean, Ex_mean, C_SD, Ex_SD) <span class="sc">%&gt;%</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">paste0</span>(.x, <span class="st">"_new"</span>), <span class="sc">-</span>ES_ID)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">&lt;-</span> db_before <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_after, <span class="at">by =</span> <span class="st">"ES_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ch_C_mean  =</span> (C_mean  <span class="sc">!=</span> C_mean_new)  <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(C_mean)  <span class="sc">&amp;</span> <span class="fu">is.na</span>(C_mean_new)),</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">ch_Ex_mean =</span> (Ex_mean <span class="sc">!=</span> Ex_mean_new) <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(Ex_mean) <span class="sc">&amp;</span> <span class="fu">is.na</span>(Ex_mean_new)),</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">ch_C_SD    =</span> (C_SD    <span class="sc">!=</span> C_SD_new)    <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(C_SD)    <span class="sc">&amp;</span> <span class="fu">is.na</span>(C_SD_new)),</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">ch_Ex_SD   =</span> (Ex_SD   <span class="sc">!=</span> Ex_SD_new)   <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(Ex_SD)   <span class="sc">&amp;</span> <span class="fu">is.na</span>(Ex_SD_new)),</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">any_change =</span> ch_C_mean <span class="sc">|</span> ch_Ex_mean <span class="sc">|</span> ch_C_SD <span class="sc">|</span> ch_Ex_SD</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Table 1: Summary counts  ----</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>tab_counts <span class="ot">&lt;-</span> diff <span class="sc">%&gt;%</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total effect sizes</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Any change</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(any_change),</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Control mean changed</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(ch_C_mean),</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Experimental mean changed</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(ch_Ex_mean),</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Control SD changed</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(ch_C_SD),</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Experimental SD changed</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(ch_Ex_SD)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tab_counts, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">caption =</span> <span class="st">"Audit summary: number of effect sizes modified by the continuity correction."</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<caption>Audit summary: number of effect sizes modified by the continuity correction.</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Total effect sizes</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Any change</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Control mean changed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Experimental mean changed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Control SD changed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Experimental SD changed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">298</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Table 2: Row-level details (only rows that changed) ----</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tab_changes <span class="ot">&lt;-</span> diff <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(any_change) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Study_ID, ES_ID) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    Study_ID, ES_ID, Cohort_ID, Assay_type, Measurment_variable, Data_type,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">C_mean (old)</span><span class="st">`</span> <span class="ot">=</span> C_mean, <span class="st">`</span><span class="at">C_mean (new)</span><span class="st">`</span> <span class="ot">=</span> C_mean_new,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">C_SD (old)</span><span class="st">`</span>   <span class="ot">=</span> C_SD,   <span class="st">`</span><span class="at">C_SD (new)</span><span class="st">`</span>   <span class="ot">=</span> C_SD_new,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Ex_mean (old)</span><span class="st">`</span> <span class="ot">=</span> Ex_mean, <span class="st">`</span><span class="at">Ex_mean (new)</span><span class="st">`</span> <span class="ot">=</span> Ex_mean_new,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Ex_SD (old)</span><span class="st">`</span>   <span class="ot">=</span> Ex_SD,   <span class="st">`</span><span class="at">Ex_SD (new)</span><span class="st">`</span>   <span class="ot">=</span> Ex_SD_new</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  tab_changes,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Audit details: effect sizes where any value was modified (old vs new)."</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"350px"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:350px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-condensed caption-top table-sm small">
<caption>Audit details: effect sizes where any value was modified (old vs new).</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Study_ID</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">ES_ID</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Cohort_ID</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Assay_type</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Measurment_variable</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Data_type</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">C_mean (old)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">C_mean (new)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">C_SD (old)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">C_SD (new)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Ex_mean (old)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Ex_mean (new)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Ex_SD (old)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Ex_SD (new)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Krishnamurthy_2025_INDIANJTRADITKNOW</td>
<td style="text-align: left;">es001</td>
<td style="text-align: left;">Krishnamurthy_2025_INDIANJTRADITKNOW_Ex-ID</td>
<td style="text-align: left;">Elevated Plus Maze</td>
<td style="text-align: left;">Open arm entries</td>
<td style="text-align: left;">count</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">2.710</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">2.002</td>
<td style="text-align: right;">2.002</td>
<td style="text-align: right;">1.051</td>
<td style="text-align: right;">1.051</td>
</tr>
<tr class="even">
<td style="text-align: left;">Krishnamurthy_2025_INDIANJTRADITKNOW</td>
<td style="text-align: left;">es003</td>
<td style="text-align: left;">Krishnamurthy_2025_INDIANJTRADITKNOW_Ex-ID</td>
<td style="text-align: left;">Elevated Plus Maze</td>
<td style="text-align: left;">Time in open arms</td>
<td style="text-align: left;">time</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">2.467</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">31.378</td>
<td style="text-align: right;">31.378</td>
<td style="text-align: right;">23.443</td>
<td style="text-align: right;">23.443</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Krishnamurthy_2025_INDIANJTRADITKNOW</td>
<td style="text-align: left;">es005</td>
<td style="text-align: left;">Krishnamurthy_2025_INDIANJTRADITKNOW_Ex-ID</td>
<td style="text-align: left;">Elevated Plus Maze</td>
<td style="text-align: left;">Head dips</td>
<td style="text-align: left;">count</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">5.099</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">3.256</td>
<td style="text-align: right;">3.256</td>
<td style="text-align: right;">1.305</td>
<td style="text-align: right;">1.305</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ren_2024_ASEAN</td>
<td style="text-align: left;">es174</td>
<td style="text-align: left;">Ren_2024_ASEAN_Ex-ID</td>
<td style="text-align: left;">Elevated Plus Maze</td>
<td style="text-align: left;">Distance open arm</td>
<td style="text-align: left;">distance</td>
<td style="text-align: right;">18.237</td>
<td style="text-align: right;">18.237</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">194.529</td>
<td style="text-align: right;">194.529</td>
<td style="text-align: right;">221.071</td>
<td style="text-align: right;">221.071</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ren_2024_ASEAN</td>
<td style="text-align: left;">es175</td>
<td style="text-align: left;">Ren_2024_ASEAN_Ex-ID</td>
<td style="text-align: left;">Elevated Plus Maze</td>
<td style="text-align: left;">Distance open arm</td>
<td style="text-align: left;">distance</td>
<td style="text-align: right;">18.237</td>
<td style="text-align: right;">18.237</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">489.362</td>
<td style="text-align: right;">489.362</td>
<td style="text-align: right;">480.589</td>
<td style="text-align: right;">480.589</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">lnRR</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">lnVR</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">lnCVR</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>calculate_lnRR <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1. Standardize Data_type first (needed for filtering)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2. Apply continuity correction ONLY to non-percentage data</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  dt_nonperc <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply_continuity_within_group</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">mult =</span> <span class="fl">0.9</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3. Handle percentage data separately (bounded safeguards)</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  dt_perc <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Guard against exact 0 and 100 on 0–100 scales (symmetrically)</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_mean  =</span> <span class="fu">ifelse</span>(C_mean  <span class="sc">==</span> <span class="dv">0</span>,   <span class="fl">0.5</span>,  C_mean),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_mean =</span> <span class="fu">ifelse</span>(Ex_mean <span class="sc">==</span> <span class="dv">0</span>,   <span class="fl">0.5</span>,  Ex_mean),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_mean  =</span> <span class="fu">ifelse</span>(C_mean  <span class="sc">==</span> <span class="dv">100</span>, <span class="fl">99.5</span>, C_mean),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_mean =</span> <span class="fu">ifelse</span>(Ex_mean <span class="sc">==</span> <span class="dv">100</span>, <span class="fl">99.5</span>, Ex_mean),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Guard against SD = 0 for bounded outcomes (symmetrically)</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_SD  =</span> <span class="fu">ifelse</span>(C_SD  <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">0.5</span>, C_SD),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_SD =</span> <span class="fu">ifelse</span>(Ex_SD <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">0.5</span>, Ex_SD)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4. Recombine (preserve original ordering if ES_ID exists)</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dt_nonperc, dt_perc) <span class="sc">%&gt;%</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    { <span class="cf">if</span> (<span class="st">"ES_ID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(.)) <span class="fu">arrange</span>(., ES_ID) <span class="cf">else</span> . }</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5. Setup</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  dt1 <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">lnRR =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">lnRR_var =</span> <span class="cn">NA_real_</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  asin_trans <span class="ot">&lt;-</span> <span class="cf">function</span>(proportion) <span class="fu">asin</span>(<span class="fu">sqrt</span>(proportion))</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 6. Calculation Loop</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dt1))) {</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    Ex_n <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_n[i]</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    C_n <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_n[i]</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    Ex_mean <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_mean[i]</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    C_mean <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_mean[i]</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    Ex_SD <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_SD[i]</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    C_SD <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_SD[i]</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    Data_type <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Data_type[i]</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    Comparison_structure <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Comparison_structure[i]</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    Higher_better <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Higher_better[i]</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- A. Continuous Data ---</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"distance"</span>, <span class="st">"count"</span>, <span class="st">"latency"</span>, <span class="st">"index"</span>)) {</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Independent"</span>) {</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"ROM"</span>,</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">n1i =</span> Ex_n, <span class="at">n2i =</span> C_n,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">m1i =</span> Ex_mean, <span class="at">m2i =</span> C_mean,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnRR"</span>, <span class="st">"lnRR_var"</span>)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Dependent"</span>) {</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"ROMC"</span>,</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>          <span class="at">ni =</span> (Ex_n <span class="sc">+</span> C_n) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">m1i =</span> Ex_mean, <span class="at">m2i =</span> C_mean,</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>          <span class="at">ri =</span> <span class="fl">0.5</span>,</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnRR"</span>, <span class="st">"lnRR_var"</span>)</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnRR[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnRR</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnRR_var[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnRR_var</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Direction harmonization (keep as you had it)</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Higher_better <span class="sc">==</span> <span class="st">"Yes"</span>) dt1<span class="sc">$</span>lnRR[i] <span class="ot">&lt;-</span> <span class="sc">-</span>dt1<span class="sc">$</span>lnRR[i]</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- B. Proportion Data (Percentage) ---</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) {</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Conditional rescaling (0–100 -&gt; 0–1)</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">max</span>(<span class="fu">c</span>(Ex_mean, C_mean), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>        Ex_mean <span class="ot">&lt;-</span> Ex_mean <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>        C_mean  <span class="ot">&lt;-</span> C_mean  <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>        Ex_SD   <span class="ot">&lt;-</span> Ex_SD   <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>        C_SD    <span class="ot">&lt;-</span> C_SD    <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Transform SDs</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>      Ex_SD_trans <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(Ex_SD<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> Ex_mean <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> Ex_mean)))</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>      C_SD_trans  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(C_SD<span class="sc">^</span><span class="dv">2</span>  <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> C_mean  <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> C_mean)))</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Transform means</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>      Ex_mean_trans <span class="ot">&lt;-</span> <span class="fu">asin_trans</span>(Ex_mean)</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>      C_mean_trans  <span class="ot">&lt;-</span> <span class="fu">asin_trans</span>(C_mean)</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>      <span class="co"># lnRR</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>      lnRR_pro_calc <span class="ot">&lt;-</span> <span class="fu">log</span>(Ex_mean_trans <span class="sc">/</span> C_mean_trans)</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Sampling variance</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>      V_Ex <span class="ot">&lt;-</span> (Ex_SD_trans)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> (Ex_mean_trans<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> Ex_n))</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>      V_C  <span class="ot">&lt;-</span> (C_SD_trans)<span class="sc">^</span><span class="dv">2</span>  <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> (C_mean_trans<span class="sc">^</span><span class="dv">2</span>  <span class="sc">*</span> C_n))</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Independent"</span>) {</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>        lnRR_var_pro <span class="ot">&lt;-</span> V_Ex <span class="sc">+</span> V_C</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Dependent"</span>) {</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>        lnRR_var_pro <span class="ot">&lt;-</span> V_Ex <span class="sc">+</span> V_C <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">sqrt</span>(V_Ex) <span class="sc">*</span> <span class="fu">sqrt</span>(V_C)</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Higher_better <span class="sc">==</span> <span class="st">"Yes"</span>) lnRR_pro_calc <span class="ot">&lt;-</span> <span class="sc">-</span>lnRR_pro_calc</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnRR[i] <span class="ot">&lt;-</span> lnRR_pro_calc</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnRR_var[i] <span class="ot">&lt;-</span> lnRR_var_pro</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt1)</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>db_lnRR <span class="ot">&lt;-</span> <span class="fu">calculate_lnRR</span>(db)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>calculate_lnVR <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1. Filter out Proportional Data</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(dt) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No non-percentage data remaining for lnVR calculation."</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(dt)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2. Data Cleaning and Imputation</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">apply_continuity_within_group</span>(dt,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">mult =</span> <span class="fl">0.9</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3. Setup</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>lnVR <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>lnVR_var <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4. Calculation Loop</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dt))) {</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract variables</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    Ex_n <span class="ot">&lt;-</span> dt<span class="sc">$</span>Ex_n[i]</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    C_n <span class="ot">&lt;-</span> dt<span class="sc">$</span>C_n[i]</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    Ex_SD <span class="ot">&lt;-</span> dt<span class="sc">$</span>Ex_SD[i]</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    C_SD <span class="ot">&lt;-</span> dt<span class="sc">$</span>C_SD[i]</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    Data_type <span class="ot">&lt;-</span> dt<span class="sc">$</span>Data_type[i]</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    Comparison_structure <span class="ot">&lt;-</span> dt<span class="sc">$</span>Comparison_structure[i]</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Continuous Data ---</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"distance"</span>, <span class="st">"count"</span>, <span class="st">"latency"</span>, <span class="st">"index"</span>)) {</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># A. INDEPENDENT GROUPS</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Independent"</span>) {</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># measure = "VR" (Variability Ratio for independent groups)</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Requires n1i, n2i, sd1i, sd2i</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"VR"</span>, </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">n1i =</span> Ex_n, <span class="at">n2i =</span> C_n,</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnVR"</span>, <span class="st">"lnVR_var"</span>)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># B. DEPENDENT GROUPS</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Dependent"</span>) {</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># measure = "VRC" (Variability Ratio for Correlated/Dependent groups)</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Requires 'ni' (sample size of pairs) and 'ri' (correlation)</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We assume ri = 0.5 (consistent with the lnRR approach)</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"VRC"</span>, </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">ni =</span> (Ex_n <span class="sc">+</span> C_n) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Use average N for the pair</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">ri =</span> <span class="fl">0.5</span>, </span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnVR"</span>, <span class="st">"lnVR_var"</span>)</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Assign results</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>      dt<span class="sc">$</span>lnVR[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnVR</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>      dt<span class="sc">$</span>lnVR_var[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnVR_var</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>db_lnVR <span class="ot">&lt;-</span> <span class="fu">calculate_lnVR</span>(db)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>calculate_lnCVR <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1. Filter out Proportional Data (bounded outcomes)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(dt) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No non-percentage data remaining for lnCVR calculation."</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(dt)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2. Data Cleaning and Safeguards</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">apply_continuity_within_group</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  dt,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">mult =</span> <span class="fl">0.9</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3. Setup</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  dt1 <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">lnCVR =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">lnCVR_var =</span> <span class="cn">NA_real_</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4. Calculation Loop</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dt1))) {</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract variables</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    Ex_n <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_n[i]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    C_n  <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_n[i]</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    Ex_mean <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_mean[i]</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    C_mean  <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_mean[i]</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    Ex_SD <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_SD[i]</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    C_SD  <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_SD[i]</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    Data_type <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Data_type[i]</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    Comparison_structure <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Comparison_structure[i]</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Continuous Data ---</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"distance"</span>, <span class="st">"count"</span>, <span class="st">"latency"</span>, <span class="st">"index"</span>)) {</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>      <span class="co"># A. INDEPENDENT GROUPS</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Independent"</span>) {</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># measure = "CVR" (Coefficient of Variation Ratio; independent groups)</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"CVR"</span>,</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>          <span class="at">n1i =</span> Ex_n, <span class="at">n2i =</span> C_n,</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>          <span class="at">m1i =</span> Ex_mean, <span class="at">m2i =</span> C_mean,</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnCVR"</span>, <span class="st">"lnCVR_var"</span>)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>      <span class="co"># B. DEPENDENT GROUPS</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Dependent"</span>) {</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># measure = "CVRC" (CV ratio for correlated/paired groups)</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># assumes ri = 0.5 for within-subject correlation</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"CVRC"</span>,</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">ni =</span> (Ex_n <span class="sc">+</span> C_n) <span class="sc">/</span> <span class="dv">2</span>,   <span class="co"># average N for the pair</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">m1i =</span> Ex_mean, <span class="at">m2i =</span> C_mean,</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>          <span class="at">ri =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnCVR"</span>, <span class="st">"lnCVR_var"</span>)</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Assign results</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnCVR[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnCVR</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnCVR_var[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnCVR_var</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt1)</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>db_lnCVR <span class="ot">&lt;-</span> <span class="fu">calculate_lnCVR</span>(db)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</div>
<p>Save the analysis-ready effect size table</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>db_es <span class="ot">&lt;-</span> db_lnRR <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    db_lnVR <span class="sc">%&gt;%</span> <span class="fu">select</span>(ES_ID, lnVR, lnVR_var),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"ES_ID"</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    db_lnCVR <span class="sc">%&gt;%</span> <span class="fu">select</span>(ES_ID, lnCVR, lnCVR_var),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"ES_ID"</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(db_es, <span class="fu">here</span>(<span class="st">".."</span>,<span class="st">"data"</span>,<span class="st">"db_effect_sizes.csv"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We load the dataset for visuallization</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>db_es <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">".."</span>,<span class="st">"data"</span>,<span class="st">"db_effect_sizes.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1) Prepare vectors (drop NAs) ---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x_eff <span class="ot">&lt;-</span> db_es <span class="sc">%&gt;%</span> <span class="fu">select</span>(lnRR, lnVR, lnCVR) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>x_eff <span class="ot">&lt;-</span> x_eff[<span class="fu">is.finite</span>(x_eff)]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>x_var <span class="ot">&lt;-</span> db_es <span class="sc">%&gt;%</span> <span class="fu">select</span>(lnRR_var, lnVR_var, lnCVR_var) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>x_var <span class="ot">&lt;-</span> x_var[<span class="fu">is.finite</span>(x_var)]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2) Shared x-limits + binwidths (30 bins across the pooled range) ---</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>xlim_eff <span class="ot">&lt;-</span> <span class="fu">range</span>(x_eff)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>xlim_var <span class="ot">&lt;-</span> <span class="fu">range</span>(x_var)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>bw_eff <span class="ot">&lt;-</span> <span class="fu">diff</span>(xlim_eff) <span class="sc">/</span> <span class="dv">30</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>bw_var <span class="ot">&lt;-</span> <span class="fu">diff</span>(xlim_var) <span class="sc">/</span> <span class="dv">30</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3) Shared y-limits (max bin count across variables, using same breaks) ---</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>breaks_eff <span class="ot">&lt;-</span> <span class="fu">seq</span>(xlim_eff[<span class="dv">1</span>], xlim_eff[<span class="dv">2</span>], <span class="at">by =</span> bw_eff)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>breaks_var <span class="ot">&lt;-</span> <span class="fu">seq</span>(xlim_var[<span class="dv">1</span>], xlim_var[<span class="dv">2</span>], <span class="at">by =</span> bw_var)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>ymax_eff <span class="ot">&lt;-</span> <span class="fu">max</span>(</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnRR,  <span class="at">breaks =</span> breaks_eff, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnVR,  <span class="at">breaks =</span> breaks_eff, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnCVR, <span class="at">breaks =</span> breaks_eff, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>ymax_var <span class="ot">&lt;-</span> <span class="fu">max</span>(</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnRR_var,  <span class="at">breaks =</span> breaks_var, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnVR_var,  <span class="at">breaks =</span> breaks_var, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnCVR_var, <span class="at">breaks =</span> breaks_var, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4) Plot helper (standardized x/y) ---</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>plot_hist <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var, title, bw, xlim, ymax) {</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> {{ var }})) <span class="sc">+</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> bw, <span class="at">boundary =</span> xlim[<span class="dv">1</span>], <span class="at">closed =</span> <span class="st">"left"</span>) <span class="sc">+</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> xlim, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ymax)) <span class="sc">+</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">x =</span> title, <span class="at">y =</span> <span class="st">"Count"</span>)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5) Effect-size histograms (shared axes) ---</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>p_lnRR   <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnRR,   <span class="st">"lnRR"</span>,   bw_eff, xlim_eff, ymax_eff)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>p_lnVR   <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnVR,   <span class="st">"lnVR"</span>,   bw_eff, xlim_eff, ymax_eff)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>p_lnCVR  <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnCVR,  <span class="st">"lnCVR"</span>,  bw_eff, xlim_eff, ymax_eff)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6) Sampling-variance histograms (shared axes) ---</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>p_lnRR_v  <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnRR_var,  <span class="st">"lnRR_var"</span>,  bw_var, xlim_var, ymax_var)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>p_lnVR_v  <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnVR_var,  <span class="st">"lnVR_var"</span>,  bw_var, xlim_var, ymax_var)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>p_lnCVR_v <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnCVR_var, <span class="st">"lnCVR_var"</span>, bw_var, xlim_var, ymax_var)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 7) Arrange (3 rows × 2 columns) ---</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>(p_lnRR <span class="sc">|</span> p_lnRR_v) <span class="sc">/</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>(p_lnVR <span class="sc">|</span> p_lnVR_v) <span class="sc">/</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>(p_lnCVR <span class="sc">|</span> p_lnCVR_v)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="effect_size_calculation_files/figure-html/histograms_standardized_axes-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-page-right">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="Online supplementary">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Online supplementary</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./overall_effect.html" class="pagination-link" aria-label="Overall effects">
        <span class="nav-page-text"><span class="chapter-title">Overall effects</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Effect size calculation"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: true</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>               DT,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>               dtplyr,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>               here, </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>               knitr,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>               tidyverse,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>               patchwork,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>               metafor,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>               orchaRd, kableExtra</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># lnRR</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>This section estimates the log response ratio (lnRR), which quantifies whether music exposure changes the average level of a behavioral outcome relative to controls.</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>::: card</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>The lnRR is defined as: $$</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>\begin{equation} \label{eq:lnRR}</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>\ln RR =</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>\ln\left(\frac{M_T}{M_C}\right)</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>+</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>\frac{1}{2}</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>\left(</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>\frac{SD_T^2}{N_T M_T^2}</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>-</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>\frac{SD_C^2}{N_C M_C^2}</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>\right),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>$$ where $M_T$ and $M_C$ denote the sample means, $SD_T$ and $SD_C$ the sample standard deviations, and $N_T$ and $N_C$ the sample sizes of the music-exposed (treatment) and control groups, respectively.</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>Negative lnRR values indicate reductions in anxiety- or depression-like behavior under music exposure (after directional harmonization). Specifically, we harmonize outcome direction using the variable <span class="in">`Higher_better`</span> such that lnRR is multiplied by $−1$ when higher values represent improved outcomes (e.g., more exploration or less immobility).</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="fu"># lnVR</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>Here we estimate the log variability ratio (lnVR), which quantifies whether music exposure changes the dispersion (standard deviation) of behavioral outcomes relative to controls.</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>::: card</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>lnVR is defined as</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>\ln VR = \ln\left(\frac{SD_T}{SD_C}\right) + \frac{1}{2}\left(\frac{1}{N_T-1}-\frac{1}{N_C-1}\right)</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>where $SD$ is the standard deviation and $N$ is the sample size for treatment ($T$) and control ($C$) groups.</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>A positive lnVR indicates higher variability under music exposure (less consistent responses), whereas a negative lnVR indicates lower variability (more consistent responses).</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="fu"># lnCVR</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>Finally, we estimate the log coefficient of variation ratio (lnCVR). Whereas lnVR compares standard deviations directly, lnCVR compares relative variability, thereby accounting for differences in group means. This is useful when variability is expected to scale with the mean.</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>::: card</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>lnCVR is defined as</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>\ln \text{CVR} = \ln \left( \frac{CV_T}{CV_C} \right) + \frac{1}{2} \left( \frac{1}{n_T - 1} - \frac{1}{n_C - 1} \right) - \frac{1}{2} \left( \frac{s_T^2}{n_T M_T^2} - \frac{s_C^2}{n_C M_C^2} \right)</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>where $M$, $SD$, amd $n$ are the sample mean, standard deviation, and sample size for treatment ($T$) and control ($C$) groups, respectively. $\text{with} \quad CV = \frac{SD}{M}$</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>A positive lnCVR indicates higher relative variability (higher $CV$) under music exposure, whereas a negative lnCVR indicates lower relative variability (lower $CV$). </span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a><span class="fu"># Functions and computation</span></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a><span class="fu"># Shared workflow details for effect-size functions</span></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>All three effect-size functions (<span class="in">`calculate_lnRR()`</span>, <span class="in">`calculate_lnVR()`</span>, <span class="in">`calculate_lnCVR()`</span>) follow the same general preprocessing and design-handling logic to ensure numerical stability and consistent treatment of study designs.</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data-type handling</span></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Outcomes are categorized via <span class="in">`Data_type`</span>.</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Proportional outcomes (<span class="in">`Data_type == "percentage"`</span>) are treated separately for lnRR (variance-stabilizing transformation), and excluded from lnVR and lnCVR because bounded scales induce a mechanical mean–variance relationship that complicates biological interpretation of variability metrics.</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a><span class="fu">## Boundary corrections and numerical safeguards</span></span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>To prevent undefined operations (e.g., log(0) or division by zero), the functions apply small boundary corrections when needed:</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>means reported as exactly 0 are shifted to a small positive constant (e.g., 0.005),</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>standard deviations reported as 0 are shifted to small positive constants (e.g., 0.01 / 0.05).</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>These adjustments are strictly pragmatic and affect only edge cases where effect sizes would otherwise be undefined.</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a><span class="fu">## Standard deviation imputation (when required)</span></span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>When studies report standard errors but not standard deviations, SDs are derived using:</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>\text{SD} = \text{SE} \times \sqrt{N}</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>This imputation is performed during data preprocessing (before effect size computation) so that all effect-size functions operate on complete <span class="in">`SD`</span> fields.</span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a><span class="fu">## Independent vs dependent comparisons</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>Each function accounts for whether treatment and control groups are independent (different animals) or dependent (paired / repeated measures), using <span class="in">`Comparison_structure`</span>:</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Independent: standard two-group estimators are used.</span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dependent: correlated-sample estimators are used, and sampling variances include the covariance term implied by within-subject correlation.</span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>When correlation is not reported, we assume a moderate within-subject correlation of $r = 0.5$, consistent across lnRR, lnVR, and lnCVR, to enable variance estimation for paired designs.</span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a><span class="fu">## Direction harmonization</span></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>Direction harmonization (multiplying by $−1$ using <span class="in">`Higher_better`</span>) is applied only to lnRR, because it represents a mean shift with a natural “beneficial vs harmful” polarity after standardizing outcome direction. Variability metrics (lnVR and lnCVR) are interpreted directly (positive = more variable under music; negative = less variable), since dispersion is not inherently “good” or “bad” across outcomes.</span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_and_preprocess_db</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">".."</span>,<span class="st">"data"</span>,<span class="st">"db251124.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(C_n, Ex_n, C_mean, Ex_mean, C_SE, Ex_SE, C_SD, Ex_SD), as.numeric),</span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)),</span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">Comparison_structure =</span> <span class="fu">as.character</span>(Comparison_structure),</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">Higher_better =</span> <span class="fu">as.character</span>(Higher_better)</span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Impute SD when missing but SE available: SD = SE * sqrt(n)</span></span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">C_SD  =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(C_SD)  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(C_SE)  <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(C_n),  C_SE  <span class="sc">*</span> <span class="fu">sqrt</span>(C_n),  C_SD),</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ex_SD =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Ex_SD) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Ex_SE) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Ex_n), Ex_SE <span class="sc">*</span> <span class="fu">sqrt</span>(Ex_n), Ex_SD)</span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Helpful unique cohort identifier (optional)</span></span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cohort_ID =</span> <span class="fu">paste</span>(Study_ID, <span class="st">"Ex-ID"</span>, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to handle zeros in means and SDs?</span></span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>Some studies report means or standard deviations equal to zero (often due to rounding, reporting limits, or zero-inflated measures). Because our effect sizes involve log ratios (e.g., lnRR, lnVR, lnCVR), exact zeros can produce undefined values (e.g., log(0) or division by zero). To avoid dropping these effect sizes, we apply a small continuity correction that is conservative and grounded in the observed data.</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>This callout contains (i) a continuity-correction helper used during effect-size calculation and (ii) a small audit routine that verifies exactly which rows were modified.</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>1) <span class="in">`min_pos()`</span>: find the smallest non-zero value. This is used to define a “biologically realistic” continuity correction based on observed data rather than an arbitrary constant.</span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>2) <span class="in">`apply_continuity_within_group()`</span>: continuity correction within outcome strata, separately for each group (control or experimental). This function prevents undefined computations (e.g., log(0) or division by 0)</span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>::: card</span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step-by-step</span></span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Standardize types</span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>Converts Data_type to lowercase.</span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>Coerces <span class="in">`C_mean`</span>, <span class="in">`Ex_mean`</span>, <span class="in">`C_SD`</span>, and <span class="in">`Ex_SD`</span> to numeric to ensure reliable comparisons to zero</span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Define “local” minima within strata</span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a>The dataset is grouped by strata (default: <span class="in">`Assay_type`</span> × <span class="in">`Measurment_variable`</span> × <span class="in">`Data_type`</span>).</span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-182"><a href="#cb16-182" aria-hidden="true" tabindex="-1"></a>Within each stratum, it computes:</span>
<span id="cb16-183"><a href="#cb16-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a><span class="in">`min_C_mean_pos`</span>: smallest positive control mean</span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a><span class="in">`min_Ex_mean_pos`</span>: smallest positive experimental mean</span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a>These are computed separately for control and experimental groups</span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Compute continuity constants (epsilons)</span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a>For each stratum:</span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a><span class="in">`eps_C_mean`</span> = <span class="in">`mult × min_C_mean_pos`</span> </span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a><span class="in">`eps_Ex_mean`</span> = <span class="in">`mult × min_Ex_mean_pos`</span> </span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a>With mult = $0.9$, the replacement value is slightly smaller than the smallest observed non-zero value in that stratum, keeping it within a plausible range.</span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Apply corrections</span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a>If <span class="in">`C_mean == 0`</span>, replace with <span class="in">`eps_C_mean`</span></span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a>If <span class="in">`Ex_mean == 0`</span>, replace with <span class="in">`eps_Ex_mean`</span></span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>This ensures means are non-zero where required</span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-208"><a href="#cb16-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-209"><a href="#cb16-209" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-210"><a href="#cb16-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-211"><a href="#cb16-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-214"><a href="#cb16-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-215"><a href="#cb16-215" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: helper_continuity_group</span></span>
<span id="cb16-216"><a href="#cb16-216" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb16-217"><a href="#cb16-217" aria-hidden="true" tabindex="-1"></a>min_pos <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb16-218"><a href="#cb16-218" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[<span class="fu">is.finite</span>(x) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(x) <span class="sc">&amp;</span> x <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb16-219"><a href="#cb16-219" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA_real_</span>)</span>
<span id="cb16-220"><a href="#cb16-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(x)</span>
<span id="cb16-221"><a href="#cb16-221" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-222"><a href="#cb16-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-223"><a href="#cb16-223" aria-hidden="true" tabindex="-1"></a>apply_continuity_within_group <span class="ot">&lt;-</span> <span class="cf">function</span>(dt,</span>
<span id="cb16-224"><a href="#cb16-224" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb16-225"><a href="#cb16-225" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">mult =</span> <span class="fl">0.9</span>) {</span>
<span id="cb16-226"><a href="#cb16-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-227"><a href="#cb16-227" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-228"><a href="#cb16-228" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb16-229"><a href="#cb16-229" aria-hidden="true" tabindex="-1"></a>      <span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)),</span>
<span id="cb16-230"><a href="#cb16-230" aria-hidden="true" tabindex="-1"></a>      <span class="fu">across</span>(<span class="fu">c</span>(C_mean, Ex_mean, C_SD, Ex_SD), <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb16-231"><a href="#cb16-231" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-232"><a href="#cb16-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-233"><a href="#cb16-233" aria-hidden="true" tabindex="-1"></a>  mins <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-234"><a href="#cb16-234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(strata))) <span class="sc">%&gt;%</span></span>
<span id="cb16-235"><a href="#cb16-235" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb16-236"><a href="#cb16-236" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_C_mean_pos  =</span> <span class="fu">min_pos</span>(C_mean),</span>
<span id="cb16-237"><a href="#cb16-237" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_Ex_mean_pos =</span> <span class="fu">min_pos</span>(Ex_mean),</span>
<span id="cb16-238"><a href="#cb16-238" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb16-239"><a href="#cb16-239" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-240"><a href="#cb16-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-241"><a href="#cb16-241" aria-hidden="true" tabindex="-1"></a>  g_C_mean  <span class="ot">&lt;-</span> <span class="fu">min_pos</span>(dt<span class="sc">$</span>C_mean)</span>
<span id="cb16-242"><a href="#cb16-242" aria-hidden="true" tabindex="-1"></a>  g_Ex_mean <span class="ot">&lt;-</span> <span class="fu">min_pos</span>(dt<span class="sc">$</span>Ex_mean)</span>
<span id="cb16-243"><a href="#cb16-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-244"><a href="#cb16-244" aria-hidden="true" tabindex="-1"></a>  dt <span class="sc">%&gt;%</span></span>
<span id="cb16-245"><a href="#cb16-245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(mins, <span class="at">by =</span> strata) <span class="sc">%&gt;%</span></span>
<span id="cb16-246"><a href="#cb16-246" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb16-247"><a href="#cb16-247" aria-hidden="true" tabindex="-1"></a>      <span class="at">eps_C_mean  =</span> mult <span class="sc">*</span> <span class="fu">coalesce</span>(min_C_mean_pos,  g_C_mean),</span>
<span id="cb16-248"><a href="#cb16-248" aria-hidden="true" tabindex="-1"></a>      <span class="at">eps_Ex_mean =</span> mult <span class="sc">*</span> <span class="fu">coalesce</span>(min_Ex_mean_pos, g_Ex_mean),</span>
<span id="cb16-249"><a href="#cb16-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-250"><a href="#cb16-250" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Mean correction (within-group)</span></span>
<span id="cb16-251"><a href="#cb16-251" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_mean  =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(C_mean)  <span class="sc">&amp;</span> C_mean <span class="sc">==</span> <span class="dv">0</span>,  eps_C_mean,  C_mean),</span>
<span id="cb16-252"><a href="#cb16-252" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_mean =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ex_mean) <span class="sc">&amp;</span> Ex_mean <span class="sc">==</span> <span class="dv">0</span>, eps_Ex_mean, Ex_mean),</span>
<span id="cb16-253"><a href="#cb16-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-254"><a href="#cb16-254" aria-hidden="true" tabindex="-1"></a>      <span class="co"># SD rule if SD == 0, set to 0.05</span></span>
<span id="cb16-255"><a href="#cb16-255" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_SD  =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(C_SD)  <span class="sc">&amp;</span> C_SD <span class="sc">==</span> <span class="dv">0</span>,  <span class="fl">0.05</span>, C_SD),</span>
<span id="cb16-256"><a href="#cb16-256" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_SD =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(Ex_SD) <span class="sc">&amp;</span> Ex_SD <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">0.05</span>, Ex_SD)</span>
<span id="cb16-257"><a href="#cb16-257" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb16-258"><a href="#cb16-258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>min_C_mean_pos, <span class="sc">-</span>min_Ex_mean_pos, <span class="sc">-</span>eps_C_mean, <span class="sc">-</span>eps_Ex_mean)</span>
<span id="cb16-259"><a href="#cb16-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-260"><a href="#cb16-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-261"><a href="#cb16-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-262"><a href="#cb16-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-263"><a href="#cb16-263" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Audit chunk: verify exactly which rows changed </span>
<span id="cb16-266"><a href="#cb16-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-267"><a href="#cb16-267" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: audit_helper_changes_by_esid</span></span>
<span id="cb16-268"><a href="#cb16-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb16-269"><a href="#cb16-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-270"><a href="#cb16-270" aria-hidden="true" tabindex="-1"></a>db_before <span class="ot">&lt;-</span> db <span class="sc">%&gt;%</span></span>
<span id="cb16-271"><a href="#cb16-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-272"><a href="#cb16-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)),</span>
<span id="cb16-273"><a href="#cb16-273" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(C_mean, Ex_mean, C_SD, Ex_SD), <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb16-274"><a href="#cb16-274" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-275"><a href="#cb16-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb16-276"><a href="#cb16-276" aria-hidden="true" tabindex="-1"></a>    ES_ID, Study_ID, Cohort_ID, Assay_type, Measurment_variable, Data_type,</span>
<span id="cb16-277"><a href="#cb16-277" aria-hidden="true" tabindex="-1"></a>    C_mean, Ex_mean, C_SD, Ex_SD</span>
<span id="cb16-278"><a href="#cb16-278" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-279"><a href="#cb16-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-280"><a href="#cb16-280" aria-hidden="true" tabindex="-1"></a>db_after <span class="ot">&lt;-</span> <span class="fu">apply_continuity_within_group</span>(</span>
<span id="cb16-281"><a href="#cb16-281" aria-hidden="true" tabindex="-1"></a>  db_before,</span>
<span id="cb16-282"><a href="#cb16-282" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb16-283"><a href="#cb16-283" aria-hidden="true" tabindex="-1"></a>  <span class="at">mult =</span> <span class="fl">0.9</span></span>
<span id="cb16-284"><a href="#cb16-284" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb16-285"><a href="#cb16-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ES_ID, C_mean, Ex_mean, C_SD, Ex_SD) <span class="sc">%&gt;%</span></span>
<span id="cb16-286"><a href="#cb16-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">paste0</span>(.x, <span class="st">"_new"</span>), <span class="sc">-</span>ES_ID)</span>
<span id="cb16-287"><a href="#cb16-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-288"><a href="#cb16-288" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">&lt;-</span> db_before <span class="sc">%&gt;%</span></span>
<span id="cb16-289"><a href="#cb16-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_after, <span class="at">by =</span> <span class="st">"ES_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-290"><a href="#cb16-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-291"><a href="#cb16-291" aria-hidden="true" tabindex="-1"></a>    <span class="at">ch_C_mean  =</span> (C_mean  <span class="sc">!=</span> C_mean_new)  <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(C_mean)  <span class="sc">&amp;</span> <span class="fu">is.na</span>(C_mean_new)),</span>
<span id="cb16-292"><a href="#cb16-292" aria-hidden="true" tabindex="-1"></a>    <span class="at">ch_Ex_mean =</span> (Ex_mean <span class="sc">!=</span> Ex_mean_new) <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(Ex_mean) <span class="sc">&amp;</span> <span class="fu">is.na</span>(Ex_mean_new)),</span>
<span id="cb16-293"><a href="#cb16-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">ch_C_SD    =</span> (C_SD    <span class="sc">!=</span> C_SD_new)    <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(C_SD)    <span class="sc">&amp;</span> <span class="fu">is.na</span>(C_SD_new)),</span>
<span id="cb16-294"><a href="#cb16-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">ch_Ex_SD   =</span> (Ex_SD   <span class="sc">!=</span> Ex_SD_new)   <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(Ex_SD)   <span class="sc">&amp;</span> <span class="fu">is.na</span>(Ex_SD_new)),</span>
<span id="cb16-295"><a href="#cb16-295" aria-hidden="true" tabindex="-1"></a>    <span class="at">any_change =</span> ch_C_mean <span class="sc">|</span> ch_Ex_mean <span class="sc">|</span> ch_C_SD <span class="sc">|</span> ch_Ex_SD</span>
<span id="cb16-296"><a href="#cb16-296" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-297"><a href="#cb16-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-298"><a href="#cb16-298" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Table 1: Summary counts  ----</span></span>
<span id="cb16-299"><a href="#cb16-299" aria-hidden="true" tabindex="-1"></a>tab_counts <span class="ot">&lt;-</span> diff <span class="sc">%&gt;%</span></span>
<span id="cb16-300"><a href="#cb16-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-301"><a href="#cb16-301" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total effect sizes</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb16-302"><a href="#cb16-302" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Any change</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(any_change),</span>
<span id="cb16-303"><a href="#cb16-303" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Control mean changed</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(ch_C_mean),</span>
<span id="cb16-304"><a href="#cb16-304" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Experimental mean changed</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(ch_Ex_mean),</span>
<span id="cb16-305"><a href="#cb16-305" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Control SD changed</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(ch_C_SD),</span>
<span id="cb16-306"><a href="#cb16-306" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Experimental SD changed</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(ch_Ex_SD)</span>
<span id="cb16-307"><a href="#cb16-307" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-308"><a href="#cb16-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-309"><a href="#cb16-309" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tab_counts, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">caption =</span> <span class="st">"Audit summary: number of effect sizes modified by the continuity correction."</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-310"><a href="#cb16-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb16-311"><a href="#cb16-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-312"><a href="#cb16-312" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Table 2: Row-level details (only rows that changed) ----</span></span>
<span id="cb16-313"><a href="#cb16-313" aria-hidden="true" tabindex="-1"></a>tab_changes <span class="ot">&lt;-</span> diff <span class="sc">%&gt;%</span></span>
<span id="cb16-314"><a href="#cb16-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(any_change) <span class="sc">%&gt;%</span></span>
<span id="cb16-315"><a href="#cb16-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Study_ID, ES_ID) <span class="sc">%&gt;%</span></span>
<span id="cb16-316"><a href="#cb16-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb16-317"><a href="#cb16-317" aria-hidden="true" tabindex="-1"></a>    Study_ID, ES_ID, Cohort_ID, Assay_type, Measurment_variable, Data_type,</span>
<span id="cb16-318"><a href="#cb16-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-319"><a href="#cb16-319" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">C_mean (old)</span><span class="st">`</span> <span class="ot">=</span> C_mean, <span class="st">`</span><span class="at">C_mean (new)</span><span class="st">`</span> <span class="ot">=</span> C_mean_new,</span>
<span id="cb16-320"><a href="#cb16-320" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">C_SD (old)</span><span class="st">`</span>   <span class="ot">=</span> C_SD,   <span class="st">`</span><span class="at">C_SD (new)</span><span class="st">`</span>   <span class="ot">=</span> C_SD_new,</span>
<span id="cb16-321"><a href="#cb16-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-322"><a href="#cb16-322" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Ex_mean (old)</span><span class="st">`</span> <span class="ot">=</span> Ex_mean, <span class="st">`</span><span class="at">Ex_mean (new)</span><span class="st">`</span> <span class="ot">=</span> Ex_mean_new,</span>
<span id="cb16-323"><a href="#cb16-323" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Ex_SD (old)</span><span class="st">`</span>   <span class="ot">=</span> Ex_SD,   <span class="st">`</span><span class="at">Ex_SD (new)</span><span class="st">`</span>   <span class="ot">=</span> Ex_SD_new</span>
<span id="cb16-324"><a href="#cb16-324" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-325"><a href="#cb16-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-326"><a href="#cb16-326" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb16-327"><a href="#cb16-327" aria-hidden="true" tabindex="-1"></a>  tab_changes,</span>
<span id="cb16-328"><a href="#cb16-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb16-329"><a href="#cb16-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Audit details: effect sizes where any value was modified (old vs new)."</span></span>
<span id="cb16-330"><a href="#cb16-330" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb16-331"><a href="#cb16-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-332"><a href="#cb16-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"350px"</span>)</span>
<span id="cb16-333"><a href="#cb16-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-334"><a href="#cb16-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-335"><a href="#cb16-335" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-336"><a href="#cb16-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-337"><a href="#cb16-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-338"><a href="#cb16-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-339"><a href="#cb16-339" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb16-340"><a href="#cb16-340" aria-hidden="true" tabindex="-1"></a><span class="fu">## lnRR</span></span>
<span id="cb16-341"><a href="#cb16-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-344"><a href="#cb16-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-345"><a href="#cb16-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calculate_lnRR_final</span></span>
<span id="cb16-346"><a href="#cb16-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb16-347"><a href="#cb16-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb16-348"><a href="#cb16-348" aria-hidden="true" tabindex="-1"></a>calculate_lnRR <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb16-349"><a href="#cb16-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-350"><a href="#cb16-350" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1. Standardize Data_type first (needed for filtering)</span></span>
<span id="cb16-351"><a href="#cb16-351" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-352"><a href="#cb16-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)))</span>
<span id="cb16-353"><a href="#cb16-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-354"><a href="#cb16-354" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2. Apply continuity correction ONLY to non-percentage data</span></span>
<span id="cb16-355"><a href="#cb16-355" aria-hidden="true" tabindex="-1"></a>  dt_nonperc <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-356"><a href="#cb16-356" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-357"><a href="#cb16-357" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply_continuity_within_group</span>(</span>
<span id="cb16-358"><a href="#cb16-358" aria-hidden="true" tabindex="-1"></a>      <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb16-359"><a href="#cb16-359" aria-hidden="true" tabindex="-1"></a>      <span class="at">mult =</span> <span class="fl">0.9</span></span>
<span id="cb16-360"><a href="#cb16-360" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-361"><a href="#cb16-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-362"><a href="#cb16-362" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3. Handle percentage data separately (bounded safeguards)</span></span>
<span id="cb16-363"><a href="#cb16-363" aria-hidden="true" tabindex="-1"></a>  dt_perc <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-364"><a href="#cb16-364" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-365"><a href="#cb16-365" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb16-366"><a href="#cb16-366" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Guard against exact 0 and 100 on 0–100 scales (symmetrically)</span></span>
<span id="cb16-367"><a href="#cb16-367" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_mean  =</span> <span class="fu">ifelse</span>(C_mean  <span class="sc">==</span> <span class="dv">0</span>,   <span class="fl">0.5</span>,  C_mean),</span>
<span id="cb16-368"><a href="#cb16-368" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_mean =</span> <span class="fu">ifelse</span>(Ex_mean <span class="sc">==</span> <span class="dv">0</span>,   <span class="fl">0.5</span>,  Ex_mean),</span>
<span id="cb16-369"><a href="#cb16-369" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_mean  =</span> <span class="fu">ifelse</span>(C_mean  <span class="sc">==</span> <span class="dv">100</span>, <span class="fl">99.5</span>, C_mean),</span>
<span id="cb16-370"><a href="#cb16-370" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_mean =</span> <span class="fu">ifelse</span>(Ex_mean <span class="sc">==</span> <span class="dv">100</span>, <span class="fl">99.5</span>, Ex_mean),</span>
<span id="cb16-371"><a href="#cb16-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-372"><a href="#cb16-372" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Guard against SD = 0 for bounded outcomes (symmetrically)</span></span>
<span id="cb16-373"><a href="#cb16-373" aria-hidden="true" tabindex="-1"></a>      <span class="at">C_SD  =</span> <span class="fu">ifelse</span>(C_SD  <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">0.5</span>, C_SD),</span>
<span id="cb16-374"><a href="#cb16-374" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ex_SD =</span> <span class="fu">ifelse</span>(Ex_SD <span class="sc">==</span> <span class="dv">0</span>, <span class="fl">0.5</span>, Ex_SD)</span>
<span id="cb16-375"><a href="#cb16-375" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-376"><a href="#cb16-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-377"><a href="#cb16-377" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4. Recombine (preserve original ordering if ES_ID exists)</span></span>
<span id="cb16-378"><a href="#cb16-378" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dt_nonperc, dt_perc) <span class="sc">%&gt;%</span></span>
<span id="cb16-379"><a href="#cb16-379" aria-hidden="true" tabindex="-1"></a>    { <span class="cf">if</span> (<span class="st">"ES_ID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(.)) <span class="fu">arrange</span>(., ES_ID) <span class="cf">else</span> . }</span>
<span id="cb16-380"><a href="#cb16-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-381"><a href="#cb16-381" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5. Setup</span></span>
<span id="cb16-382"><a href="#cb16-382" aria-hidden="true" tabindex="-1"></a>  dt1 <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-383"><a href="#cb16-383" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb16-384"><a href="#cb16-384" aria-hidden="true" tabindex="-1"></a>      <span class="at">lnRR =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb16-385"><a href="#cb16-385" aria-hidden="true" tabindex="-1"></a>      <span class="at">lnRR_var =</span> <span class="cn">NA_real_</span></span>
<span id="cb16-386"><a href="#cb16-386" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-387"><a href="#cb16-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-388"><a href="#cb16-388" aria-hidden="true" tabindex="-1"></a>  asin_trans <span class="ot">&lt;-</span> <span class="cf">function</span>(proportion) <span class="fu">asin</span>(<span class="fu">sqrt</span>(proportion))</span>
<span id="cb16-389"><a href="#cb16-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-390"><a href="#cb16-390" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 6. Calculation Loop</span></span>
<span id="cb16-391"><a href="#cb16-391" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dt1))) {</span>
<span id="cb16-392"><a href="#cb16-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-393"><a href="#cb16-393" aria-hidden="true" tabindex="-1"></a>    Ex_n <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_n[i]</span>
<span id="cb16-394"><a href="#cb16-394" aria-hidden="true" tabindex="-1"></a>    C_n <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_n[i]</span>
<span id="cb16-395"><a href="#cb16-395" aria-hidden="true" tabindex="-1"></a>    Ex_mean <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_mean[i]</span>
<span id="cb16-396"><a href="#cb16-396" aria-hidden="true" tabindex="-1"></a>    C_mean <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_mean[i]</span>
<span id="cb16-397"><a href="#cb16-397" aria-hidden="true" tabindex="-1"></a>    Ex_SD <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_SD[i]</span>
<span id="cb16-398"><a href="#cb16-398" aria-hidden="true" tabindex="-1"></a>    C_SD <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_SD[i]</span>
<span id="cb16-399"><a href="#cb16-399" aria-hidden="true" tabindex="-1"></a>    Data_type <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Data_type[i]</span>
<span id="cb16-400"><a href="#cb16-400" aria-hidden="true" tabindex="-1"></a>    Comparison_structure <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Comparison_structure[i]</span>
<span id="cb16-401"><a href="#cb16-401" aria-hidden="true" tabindex="-1"></a>    Higher_better <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Higher_better[i]</span>
<span id="cb16-402"><a href="#cb16-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-403"><a href="#cb16-403" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- A. Continuous Data ---</span></span>
<span id="cb16-404"><a href="#cb16-404" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"distance"</span>, <span class="st">"count"</span>, <span class="st">"latency"</span>, <span class="st">"index"</span>)) {</span>
<span id="cb16-405"><a href="#cb16-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-406"><a href="#cb16-406" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Independent"</span>) {</span>
<span id="cb16-407"><a href="#cb16-407" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb16-408"><a href="#cb16-408" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"ROM"</span>,</span>
<span id="cb16-409"><a href="#cb16-409" aria-hidden="true" tabindex="-1"></a>          <span class="at">n1i =</span> Ex_n, <span class="at">n2i =</span> C_n,</span>
<span id="cb16-410"><a href="#cb16-410" aria-hidden="true" tabindex="-1"></a>          <span class="at">m1i =</span> Ex_mean, <span class="at">m2i =</span> C_mean,</span>
<span id="cb16-411"><a href="#cb16-411" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb16-412"><a href="#cb16-412" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnRR"</span>, <span class="st">"lnRR_var"</span>)</span>
<span id="cb16-413"><a href="#cb16-413" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-414"><a href="#cb16-414" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Dependent"</span>) {</span>
<span id="cb16-415"><a href="#cb16-415" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb16-416"><a href="#cb16-416" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"ROMC"</span>,</span>
<span id="cb16-417"><a href="#cb16-417" aria-hidden="true" tabindex="-1"></a>          <span class="at">ni =</span> (Ex_n <span class="sc">+</span> C_n) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb16-418"><a href="#cb16-418" aria-hidden="true" tabindex="-1"></a>          <span class="at">m1i =</span> Ex_mean, <span class="at">m2i =</span> C_mean,</span>
<span id="cb16-419"><a href="#cb16-419" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb16-420"><a href="#cb16-420" aria-hidden="true" tabindex="-1"></a>          <span class="at">ri =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-421"><a href="#cb16-421" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnRR"</span>, <span class="st">"lnRR_var"</span>)</span>
<span id="cb16-422"><a href="#cb16-422" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-423"><a href="#cb16-423" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb16-424"><a href="#cb16-424" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb16-425"><a href="#cb16-425" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-426"><a href="#cb16-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-427"><a href="#cb16-427" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnRR[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnRR</span>
<span id="cb16-428"><a href="#cb16-428" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnRR_var[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnRR_var</span>
<span id="cb16-429"><a href="#cb16-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-430"><a href="#cb16-430" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Direction harmonization (keep as you had it)</span></span>
<span id="cb16-431"><a href="#cb16-431" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Higher_better <span class="sc">==</span> <span class="st">"Yes"</span>) dt1<span class="sc">$</span>lnRR[i] <span class="ot">&lt;-</span> <span class="sc">-</span>dt1<span class="sc">$</span>lnRR[i]</span>
<span id="cb16-432"><a href="#cb16-432" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-433"><a href="#cb16-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-434"><a href="#cb16-434" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- B. Proportion Data (Percentage) ---</span></span>
<span id="cb16-435"><a href="#cb16-435" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) {</span>
<span id="cb16-436"><a href="#cb16-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-437"><a href="#cb16-437" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Conditional rescaling (0–100 -&gt; 0–1)</span></span>
<span id="cb16-438"><a href="#cb16-438" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">max</span>(<span class="fu">c</span>(Ex_mean, C_mean), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb16-439"><a href="#cb16-439" aria-hidden="true" tabindex="-1"></a>        Ex_mean <span class="ot">&lt;-</span> Ex_mean <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb16-440"><a href="#cb16-440" aria-hidden="true" tabindex="-1"></a>        C_mean  <span class="ot">&lt;-</span> C_mean  <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb16-441"><a href="#cb16-441" aria-hidden="true" tabindex="-1"></a>        Ex_SD   <span class="ot">&lt;-</span> Ex_SD   <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb16-442"><a href="#cb16-442" aria-hidden="true" tabindex="-1"></a>        C_SD    <span class="ot">&lt;-</span> C_SD    <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb16-443"><a href="#cb16-443" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-444"><a href="#cb16-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-445"><a href="#cb16-445" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Transform SDs</span></span>
<span id="cb16-446"><a href="#cb16-446" aria-hidden="true" tabindex="-1"></a>      Ex_SD_trans <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(Ex_SD<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> Ex_mean <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> Ex_mean)))</span>
<span id="cb16-447"><a href="#cb16-447" aria-hidden="true" tabindex="-1"></a>      C_SD_trans  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(C_SD<span class="sc">^</span><span class="dv">2</span>  <span class="sc">/</span> (<span class="dv">4</span> <span class="sc">*</span> C_mean  <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> C_mean)))</span>
<span id="cb16-448"><a href="#cb16-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-449"><a href="#cb16-449" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Transform means</span></span>
<span id="cb16-450"><a href="#cb16-450" aria-hidden="true" tabindex="-1"></a>      Ex_mean_trans <span class="ot">&lt;-</span> <span class="fu">asin_trans</span>(Ex_mean)</span>
<span id="cb16-451"><a href="#cb16-451" aria-hidden="true" tabindex="-1"></a>      C_mean_trans  <span class="ot">&lt;-</span> <span class="fu">asin_trans</span>(C_mean)</span>
<span id="cb16-452"><a href="#cb16-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-453"><a href="#cb16-453" aria-hidden="true" tabindex="-1"></a>      <span class="co"># lnRR</span></span>
<span id="cb16-454"><a href="#cb16-454" aria-hidden="true" tabindex="-1"></a>      lnRR_pro_calc <span class="ot">&lt;-</span> <span class="fu">log</span>(Ex_mean_trans <span class="sc">/</span> C_mean_trans)</span>
<span id="cb16-455"><a href="#cb16-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-456"><a href="#cb16-456" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Sampling variance</span></span>
<span id="cb16-457"><a href="#cb16-457" aria-hidden="true" tabindex="-1"></a>      V_Ex <span class="ot">&lt;-</span> (Ex_SD_trans)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> (Ex_mean_trans<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> Ex_n))</span>
<span id="cb16-458"><a href="#cb16-458" aria-hidden="true" tabindex="-1"></a>      V_C  <span class="ot">&lt;-</span> (C_SD_trans)<span class="sc">^</span><span class="dv">2</span>  <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> (C_mean_trans<span class="sc">^</span><span class="dv">2</span>  <span class="sc">*</span> C_n))</span>
<span id="cb16-459"><a href="#cb16-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-460"><a href="#cb16-460" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Independent"</span>) {</span>
<span id="cb16-461"><a href="#cb16-461" aria-hidden="true" tabindex="-1"></a>        lnRR_var_pro <span class="ot">&lt;-</span> V_Ex <span class="sc">+</span> V_C</span>
<span id="cb16-462"><a href="#cb16-462" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Dependent"</span>) {</span>
<span id="cb16-463"><a href="#cb16-463" aria-hidden="true" tabindex="-1"></a>        lnRR_var_pro <span class="ot">&lt;-</span> V_Ex <span class="sc">+</span> V_C <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">sqrt</span>(V_Ex) <span class="sc">*</span> <span class="fu">sqrt</span>(V_C)</span>
<span id="cb16-464"><a href="#cb16-464" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb16-465"><a href="#cb16-465" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb16-466"><a href="#cb16-466" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-467"><a href="#cb16-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-468"><a href="#cb16-468" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Higher_better <span class="sc">==</span> <span class="st">"Yes"</span>) lnRR_pro_calc <span class="ot">&lt;-</span> <span class="sc">-</span>lnRR_pro_calc</span>
<span id="cb16-469"><a href="#cb16-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-470"><a href="#cb16-470" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnRR[i] <span class="ot">&lt;-</span> lnRR_pro_calc</span>
<span id="cb16-471"><a href="#cb16-471" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnRR_var[i] <span class="ot">&lt;-</span> lnRR_var_pro</span>
<span id="cb16-472"><a href="#cb16-472" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-473"><a href="#cb16-473" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-474"><a href="#cb16-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-475"><a href="#cb16-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt1)</span>
<span id="cb16-476"><a href="#cb16-476" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-477"><a href="#cb16-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-478"><a href="#cb16-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-479"><a href="#cb16-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-482"><a href="#cb16-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-483"><a href="#cb16-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute_lnRR</span></span>
<span id="cb16-484"><a href="#cb16-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb16-485"><a href="#cb16-485" aria-hidden="true" tabindex="-1"></a>db_lnRR <span class="ot">&lt;-</span> <span class="fu">calculate_lnRR</span>(db)</span>
<span id="cb16-486"><a href="#cb16-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-487"><a href="#cb16-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-488"><a href="#cb16-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-489"><a href="#cb16-489" aria-hidden="true" tabindex="-1"></a><span class="fu">## lnVR</span></span>
<span id="cb16-490"><a href="#cb16-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-493"><a href="#cb16-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-494"><a href="#cb16-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calculate_lnVR_final</span></span>
<span id="cb16-495"><a href="#cb16-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb16-496"><a href="#cb16-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb16-497"><a href="#cb16-497" aria-hidden="true" tabindex="-1"></a>calculate_lnVR <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb16-498"><a href="#cb16-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-499"><a href="#cb16-499" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1. Filter out Proportional Data</span></span>
<span id="cb16-500"><a href="#cb16-500" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-501"><a href="#cb16-501" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type))) <span class="sc">%&gt;%</span> </span>
<span id="cb16-502"><a href="#cb16-502" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) </span>
<span id="cb16-503"><a href="#cb16-503" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-504"><a href="#cb16-504" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(dt) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb16-505"><a href="#cb16-505" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No non-percentage data remaining for lnVR calculation."</span>)</span>
<span id="cb16-506"><a href="#cb16-506" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(dt)</span>
<span id="cb16-507"><a href="#cb16-507" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-508"><a href="#cb16-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-509"><a href="#cb16-509" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2. Data Cleaning and Imputation</span></span>
<span id="cb16-510"><a href="#cb16-510" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">apply_continuity_within_group</span>(dt,</span>
<span id="cb16-511"><a href="#cb16-511" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb16-512"><a href="#cb16-512" aria-hidden="true" tabindex="-1"></a>  <span class="at">mult =</span> <span class="fl">0.9</span></span>
<span id="cb16-513"><a href="#cb16-513" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-514"><a href="#cb16-514" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3. Setup</span></span>
<span id="cb16-515"><a href="#cb16-515" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>lnVR <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb16-516"><a href="#cb16-516" aria-hidden="true" tabindex="-1"></a>  dt<span class="sc">$</span>lnVR_var <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb16-517"><a href="#cb16-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-518"><a href="#cb16-518" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4. Calculation Loop</span></span>
<span id="cb16-519"><a href="#cb16-519" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dt))) {</span>
<span id="cb16-520"><a href="#cb16-520" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-521"><a href="#cb16-521" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract variables</span></span>
<span id="cb16-522"><a href="#cb16-522" aria-hidden="true" tabindex="-1"></a>    Ex_n <span class="ot">&lt;-</span> dt<span class="sc">$</span>Ex_n[i]</span>
<span id="cb16-523"><a href="#cb16-523" aria-hidden="true" tabindex="-1"></a>    C_n <span class="ot">&lt;-</span> dt<span class="sc">$</span>C_n[i]</span>
<span id="cb16-524"><a href="#cb16-524" aria-hidden="true" tabindex="-1"></a>    Ex_SD <span class="ot">&lt;-</span> dt<span class="sc">$</span>Ex_SD[i]</span>
<span id="cb16-525"><a href="#cb16-525" aria-hidden="true" tabindex="-1"></a>    C_SD <span class="ot">&lt;-</span> dt<span class="sc">$</span>C_SD[i]</span>
<span id="cb16-526"><a href="#cb16-526" aria-hidden="true" tabindex="-1"></a>    Data_type <span class="ot">&lt;-</span> dt<span class="sc">$</span>Data_type[i]</span>
<span id="cb16-527"><a href="#cb16-527" aria-hidden="true" tabindex="-1"></a>    Comparison_structure <span class="ot">&lt;-</span> dt<span class="sc">$</span>Comparison_structure[i]</span>
<span id="cb16-528"><a href="#cb16-528" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-529"><a href="#cb16-529" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Continuous Data ---</span></span>
<span id="cb16-530"><a href="#cb16-530" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"distance"</span>, <span class="st">"count"</span>, <span class="st">"latency"</span>, <span class="st">"index"</span>)) {</span>
<span id="cb16-531"><a href="#cb16-531" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-532"><a href="#cb16-532" aria-hidden="true" tabindex="-1"></a>      <span class="co"># A. INDEPENDENT GROUPS</span></span>
<span id="cb16-533"><a href="#cb16-533" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Independent"</span>) {</span>
<span id="cb16-534"><a href="#cb16-534" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-535"><a href="#cb16-535" aria-hidden="true" tabindex="-1"></a>        <span class="co"># measure = "VR" (Variability Ratio for independent groups)</span></span>
<span id="cb16-536"><a href="#cb16-536" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Requires n1i, n2i, sd1i, sd2i</span></span>
<span id="cb16-537"><a href="#cb16-537" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb16-538"><a href="#cb16-538" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"VR"</span>, </span>
<span id="cb16-539"><a href="#cb16-539" aria-hidden="true" tabindex="-1"></a>          <span class="at">n1i =</span> Ex_n, <span class="at">n2i =</span> C_n,</span>
<span id="cb16-540"><a href="#cb16-540" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb16-541"><a href="#cb16-541" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnVR"</span>, <span class="st">"lnVR_var"</span>)</span>
<span id="cb16-542"><a href="#cb16-542" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-543"><a href="#cb16-543" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-544"><a href="#cb16-544" aria-hidden="true" tabindex="-1"></a>      <span class="co"># B. DEPENDENT GROUPS</span></span>
<span id="cb16-545"><a href="#cb16-545" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Dependent"</span>) {</span>
<span id="cb16-546"><a href="#cb16-546" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-547"><a href="#cb16-547" aria-hidden="true" tabindex="-1"></a>        <span class="co"># measure = "VRC" (Variability Ratio for Correlated/Dependent groups)</span></span>
<span id="cb16-548"><a href="#cb16-548" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Requires 'ni' (sample size of pairs) and 'ri' (correlation)</span></span>
<span id="cb16-549"><a href="#cb16-549" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We assume ri = 0.5 (consistent with the lnRR approach)</span></span>
<span id="cb16-550"><a href="#cb16-550" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb16-551"><a href="#cb16-551" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"VRC"</span>, </span>
<span id="cb16-552"><a href="#cb16-552" aria-hidden="true" tabindex="-1"></a>          <span class="at">ni =</span> (Ex_n <span class="sc">+</span> C_n) <span class="sc">/</span> <span class="dv">2</span>, <span class="co"># Use average N for the pair</span></span>
<span id="cb16-553"><a href="#cb16-553" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb16-554"><a href="#cb16-554" aria-hidden="true" tabindex="-1"></a>          <span class="at">ri =</span> <span class="fl">0.5</span>, </span>
<span id="cb16-555"><a href="#cb16-555" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnVR"</span>, <span class="st">"lnVR_var"</span>)</span>
<span id="cb16-556"><a href="#cb16-556" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-557"><a href="#cb16-557" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-558"><a href="#cb16-558" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-559"><a href="#cb16-559" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Assign results</span></span>
<span id="cb16-560"><a href="#cb16-560" aria-hidden="true" tabindex="-1"></a>      dt<span class="sc">$</span>lnVR[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnVR</span>
<span id="cb16-561"><a href="#cb16-561" aria-hidden="true" tabindex="-1"></a>      dt<span class="sc">$</span>lnVR_var[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnVR_var</span>
<span id="cb16-562"><a href="#cb16-562" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-563"><a href="#cb16-563" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb16-564"><a href="#cb16-564" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-565"><a href="#cb16-565" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-566"><a href="#cb16-566" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-567"><a href="#cb16-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt)</span>
<span id="cb16-568"><a href="#cb16-568" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-569"><a href="#cb16-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-572"><a href="#cb16-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-573"><a href="#cb16-573" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute_lnVR</span></span>
<span id="cb16-574"><a href="#cb16-574" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb16-575"><a href="#cb16-575" aria-hidden="true" tabindex="-1"></a>db_lnVR <span class="ot">&lt;-</span> <span class="fu">calculate_lnVR</span>(db)</span>
<span id="cb16-576"><a href="#cb16-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-577"><a href="#cb16-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-578"><a href="#cb16-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-579"><a href="#cb16-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-580"><a href="#cb16-580" aria-hidden="true" tabindex="-1"></a><span class="fu">## lnCVR</span></span>
<span id="cb16-581"><a href="#cb16-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-584"><a href="#cb16-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-585"><a href="#cb16-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calculate_lnCVR_final</span></span>
<span id="cb16-586"><a href="#cb16-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: TRUE</span></span>
<span id="cb16-587"><a href="#cb16-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb16-588"><a href="#cb16-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-589"><a href="#cb16-589" aria-hidden="true" tabindex="-1"></a>calculate_lnCVR <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb16-590"><a href="#cb16-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-591"><a href="#cb16-591" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1. Filter out Proportional Data (bounded outcomes)</span></span>
<span id="cb16-592"><a href="#cb16-592" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-593"><a href="#cb16-593" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type))) <span class="sc">%&gt;%</span> </span>
<span id="cb16-594"><a href="#cb16-594" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"percentage"</span>)) </span>
<span id="cb16-595"><a href="#cb16-595" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-596"><a href="#cb16-596" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(dt) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb16-597"><a href="#cb16-597" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No non-percentage data remaining for lnCVR calculation."</span>)</span>
<span id="cb16-598"><a href="#cb16-598" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(dt)</span>
<span id="cb16-599"><a href="#cb16-599" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-600"><a href="#cb16-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-601"><a href="#cb16-601" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2. Data Cleaning and Safeguards</span></span>
<span id="cb16-602"><a href="#cb16-602" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">apply_continuity_within_group</span>(</span>
<span id="cb16-603"><a href="#cb16-603" aria-hidden="true" tabindex="-1"></a>  dt,</span>
<span id="cb16-604"><a href="#cb16-604" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="fu">c</span>(<span class="st">"Assay_type"</span>, <span class="st">"Measurment_variable"</span>, <span class="st">"Data_type"</span>),</span>
<span id="cb16-605"><a href="#cb16-605" aria-hidden="true" tabindex="-1"></a>  <span class="at">mult =</span> <span class="fl">0.9</span></span>
<span id="cb16-606"><a href="#cb16-606" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-607"><a href="#cb16-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-608"><a href="#cb16-608" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3. Setup</span></span>
<span id="cb16-609"><a href="#cb16-609" aria-hidden="true" tabindex="-1"></a>  dt1 <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb16-610"><a href="#cb16-610" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb16-611"><a href="#cb16-611" aria-hidden="true" tabindex="-1"></a>      <span class="at">lnCVR =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb16-612"><a href="#cb16-612" aria-hidden="true" tabindex="-1"></a>      <span class="at">lnCVR_var =</span> <span class="cn">NA_real_</span></span>
<span id="cb16-613"><a href="#cb16-613" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-614"><a href="#cb16-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-615"><a href="#cb16-615" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4. Calculation Loop</span></span>
<span id="cb16-616"><a href="#cb16-616" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dt1))) {</span>
<span id="cb16-617"><a href="#cb16-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-618"><a href="#cb16-618" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract variables</span></span>
<span id="cb16-619"><a href="#cb16-619" aria-hidden="true" tabindex="-1"></a>    Ex_n <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_n[i]</span>
<span id="cb16-620"><a href="#cb16-620" aria-hidden="true" tabindex="-1"></a>    C_n  <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_n[i]</span>
<span id="cb16-621"><a href="#cb16-621" aria-hidden="true" tabindex="-1"></a>    Ex_mean <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_mean[i]</span>
<span id="cb16-622"><a href="#cb16-622" aria-hidden="true" tabindex="-1"></a>    C_mean  <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_mean[i]</span>
<span id="cb16-623"><a href="#cb16-623" aria-hidden="true" tabindex="-1"></a>    Ex_SD <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Ex_SD[i]</span>
<span id="cb16-624"><a href="#cb16-624" aria-hidden="true" tabindex="-1"></a>    C_SD  <span class="ot">&lt;-</span> dt1<span class="sc">$</span>C_SD[i]</span>
<span id="cb16-625"><a href="#cb16-625" aria-hidden="true" tabindex="-1"></a>    Data_type <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Data_type[i]</span>
<span id="cb16-626"><a href="#cb16-626" aria-hidden="true" tabindex="-1"></a>    Comparison_structure <span class="ot">&lt;-</span> dt1<span class="sc">$</span>Comparison_structure[i]</span>
<span id="cb16-627"><a href="#cb16-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-628"><a href="#cb16-628" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Continuous Data ---</span></span>
<span id="cb16-629"><a href="#cb16-629" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (Data_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"distance"</span>, <span class="st">"count"</span>, <span class="st">"latency"</span>, <span class="st">"index"</span>)) {</span>
<span id="cb16-630"><a href="#cb16-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-631"><a href="#cb16-631" aria-hidden="true" tabindex="-1"></a>      <span class="co"># A. INDEPENDENT GROUPS</span></span>
<span id="cb16-632"><a href="#cb16-632" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Independent"</span>) {</span>
<span id="cb16-633"><a href="#cb16-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-634"><a href="#cb16-634" aria-hidden="true" tabindex="-1"></a>        <span class="co"># measure = "CVR" (Coefficient of Variation Ratio; independent groups)</span></span>
<span id="cb16-635"><a href="#cb16-635" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb16-636"><a href="#cb16-636" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"CVR"</span>,</span>
<span id="cb16-637"><a href="#cb16-637" aria-hidden="true" tabindex="-1"></a>          <span class="at">n1i =</span> Ex_n, <span class="at">n2i =</span> C_n,</span>
<span id="cb16-638"><a href="#cb16-638" aria-hidden="true" tabindex="-1"></a>          <span class="at">m1i =</span> Ex_mean, <span class="at">m2i =</span> C_mean,</span>
<span id="cb16-639"><a href="#cb16-639" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb16-640"><a href="#cb16-640" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnCVR"</span>, <span class="st">"lnCVR_var"</span>)</span>
<span id="cb16-641"><a href="#cb16-641" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-642"><a href="#cb16-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-643"><a href="#cb16-643" aria-hidden="true" tabindex="-1"></a>      <span class="co"># B. DEPENDENT GROUPS</span></span>
<span id="cb16-644"><a href="#cb16-644" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (Comparison_structure <span class="sc">==</span> <span class="st">"Dependent"</span>) {</span>
<span id="cb16-645"><a href="#cb16-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-646"><a href="#cb16-646" aria-hidden="true" tabindex="-1"></a>        <span class="co"># measure = "CVRC" (CV ratio for correlated/paired groups)</span></span>
<span id="cb16-647"><a href="#cb16-647" aria-hidden="true" tabindex="-1"></a>        <span class="co"># assumes ri = 0.5 for within-subject correlation</span></span>
<span id="cb16-648"><a href="#cb16-648" aria-hidden="true" tabindex="-1"></a>        effect <span class="ot">&lt;-</span> metafor<span class="sc">::</span><span class="fu">escalc</span>(</span>
<span id="cb16-649"><a href="#cb16-649" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure =</span> <span class="st">"CVRC"</span>,</span>
<span id="cb16-650"><a href="#cb16-650" aria-hidden="true" tabindex="-1"></a>          <span class="at">ni =</span> (Ex_n <span class="sc">+</span> C_n) <span class="sc">/</span> <span class="dv">2</span>,   <span class="co"># average N for the pair</span></span>
<span id="cb16-651"><a href="#cb16-651" aria-hidden="true" tabindex="-1"></a>          <span class="at">m1i =</span> Ex_mean, <span class="at">m2i =</span> C_mean,</span>
<span id="cb16-652"><a href="#cb16-652" aria-hidden="true" tabindex="-1"></a>          <span class="at">sd1i =</span> Ex_SD, <span class="at">sd2i =</span> C_SD,</span>
<span id="cb16-653"><a href="#cb16-653" aria-hidden="true" tabindex="-1"></a>          <span class="at">ri =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-654"><a href="#cb16-654" aria-hidden="true" tabindex="-1"></a>          <span class="at">var.names =</span> <span class="fu">c</span>(<span class="st">"lnCVR"</span>, <span class="st">"lnCVR_var"</span>)</span>
<span id="cb16-655"><a href="#cb16-655" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-656"><a href="#cb16-656" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb16-657"><a href="#cb16-657" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb16-658"><a href="#cb16-658" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-659"><a href="#cb16-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-660"><a href="#cb16-660" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Assign results</span></span>
<span id="cb16-661"><a href="#cb16-661" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnCVR[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnCVR</span>
<span id="cb16-662"><a href="#cb16-662" aria-hidden="true" tabindex="-1"></a>      dt1<span class="sc">$</span>lnCVR_var[i] <span class="ot">&lt;-</span> effect<span class="sc">$</span>lnCVR_var</span>
<span id="cb16-663"><a href="#cb16-663" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-664"><a href="#cb16-664" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-665"><a href="#cb16-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-666"><a href="#cb16-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt1)</span>
<span id="cb16-667"><a href="#cb16-667" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-668"><a href="#cb16-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-669"><a href="#cb16-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-672"><a href="#cb16-672" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-673"><a href="#cb16-673" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute_lnCVR</span></span>
<span id="cb16-674"><a href="#cb16-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb16-675"><a href="#cb16-675" aria-hidden="true" tabindex="-1"></a>db_lnCVR <span class="ot">&lt;-</span> <span class="fu">calculate_lnCVR</span>(db)</span>
<span id="cb16-676"><a href="#cb16-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-677"><a href="#cb16-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-678"><a href="#cb16-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-679"><a href="#cb16-679" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb16-680"><a href="#cb16-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-681"><a href="#cb16-681" aria-hidden="true" tabindex="-1"></a>Save the analysis-ready effect size table</span>
<span id="cb16-684"><a href="#cb16-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-685"><a href="#cb16-685" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: merge_effect_sizes</span></span>
<span id="cb16-686"><a href="#cb16-686" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb16-687"><a href="#cb16-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-688"><a href="#cb16-688" aria-hidden="true" tabindex="-1"></a>db_es <span class="ot">&lt;-</span> db_lnRR <span class="sc">%&gt;%</span></span>
<span id="cb16-689"><a href="#cb16-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb16-690"><a href="#cb16-690" aria-hidden="true" tabindex="-1"></a>    db_lnVR <span class="sc">%&gt;%</span> <span class="fu">select</span>(ES_ID, lnVR, lnVR_var),</span>
<span id="cb16-691"><a href="#cb16-691" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"ES_ID"</span></span>
<span id="cb16-692"><a href="#cb16-692" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-693"><a href="#cb16-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb16-694"><a href="#cb16-694" aria-hidden="true" tabindex="-1"></a>    db_lnCVR <span class="sc">%&gt;%</span> <span class="fu">select</span>(ES_ID, lnCVR, lnCVR_var),</span>
<span id="cb16-695"><a href="#cb16-695" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"ES_ID"</span></span>
<span id="cb16-696"><a href="#cb16-696" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-697"><a href="#cb16-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-698"><a href="#cb16-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-699"><a href="#cb16-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-700"><a href="#cb16-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-701"><a href="#cb16-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-704"><a href="#cb16-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-705"><a href="#cb16-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: save_effect_size_db</span></span>
<span id="cb16-706"><a href="#cb16-706" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb16-707"><a href="#cb16-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-708"><a href="#cb16-708" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(db_es, <span class="fu">here</span>(<span class="st">".."</span>,<span class="st">"data"</span>,<span class="st">"db_effect_sizes.csv"</span>))</span>
<span id="cb16-709"><a href="#cb16-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-710"><a href="#cb16-710" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-711"><a href="#cb16-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-712"><a href="#cb16-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-713"><a href="#cb16-713" aria-hidden="true" tabindex="-1"></a>We load the dataset for visuallization</span>
<span id="cb16-714"><a href="#cb16-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-717"><a href="#cb16-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-718"><a href="#cb16-718" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_effectsize_database</span></span>
<span id="cb16-719"><a href="#cb16-719" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb16-720"><a href="#cb16-720" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb16-721"><a href="#cb16-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-722"><a href="#cb16-722" aria-hidden="true" tabindex="-1"></a>db_es <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">".."</span>,<span class="st">"data"</span>,<span class="st">"db_effect_sizes.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-723"><a href="#cb16-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Data_type =</span> <span class="fu">tolower</span>(<span class="fu">as.character</span>(Data_type)))</span>
<span id="cb16-724"><a href="#cb16-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-725"><a href="#cb16-725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-726"><a href="#cb16-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-727"><a href="#cb16-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-728"><a href="#cb16-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-729"><a href="#cb16-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-730"><a href="#cb16-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-731"><a href="#cb16-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-732"><a href="#cb16-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-735"><a href="#cb16-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-736"><a href="#cb16-736" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: histograms_standardized_axes</span></span>
<span id="cb16-737"><a href="#cb16-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb16-738"><a href="#cb16-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb16-739"><a href="#cb16-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb16-740"><a href="#cb16-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-741"><a href="#cb16-741" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1) Prepare vectors (drop NAs) ---</span></span>
<span id="cb16-742"><a href="#cb16-742" aria-hidden="true" tabindex="-1"></a>x_eff <span class="ot">&lt;-</span> db_es <span class="sc">%&gt;%</span> <span class="fu">select</span>(lnRR, lnVR, lnCVR) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-743"><a href="#cb16-743" aria-hidden="true" tabindex="-1"></a>x_eff <span class="ot">&lt;-</span> x_eff[<span class="fu">is.finite</span>(x_eff)]</span>
<span id="cb16-744"><a href="#cb16-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-745"><a href="#cb16-745" aria-hidden="true" tabindex="-1"></a>x_var <span class="ot">&lt;-</span> db_es <span class="sc">%&gt;%</span> <span class="fu">select</span>(lnRR_var, lnVR_var, lnCVR_var) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-746"><a href="#cb16-746" aria-hidden="true" tabindex="-1"></a>x_var <span class="ot">&lt;-</span> x_var[<span class="fu">is.finite</span>(x_var)]</span>
<span id="cb16-747"><a href="#cb16-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-748"><a href="#cb16-748" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2) Shared x-limits + binwidths (30 bins across the pooled range) ---</span></span>
<span id="cb16-749"><a href="#cb16-749" aria-hidden="true" tabindex="-1"></a>xlim_eff <span class="ot">&lt;-</span> <span class="fu">range</span>(x_eff)</span>
<span id="cb16-750"><a href="#cb16-750" aria-hidden="true" tabindex="-1"></a>xlim_var <span class="ot">&lt;-</span> <span class="fu">range</span>(x_var)</span>
<span id="cb16-751"><a href="#cb16-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-752"><a href="#cb16-752" aria-hidden="true" tabindex="-1"></a>bw_eff <span class="ot">&lt;-</span> <span class="fu">diff</span>(xlim_eff) <span class="sc">/</span> <span class="dv">30</span></span>
<span id="cb16-753"><a href="#cb16-753" aria-hidden="true" tabindex="-1"></a>bw_var <span class="ot">&lt;-</span> <span class="fu">diff</span>(xlim_var) <span class="sc">/</span> <span class="dv">30</span></span>
<span id="cb16-754"><a href="#cb16-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-755"><a href="#cb16-755" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3) Shared y-limits (max bin count across variables, using same breaks) ---</span></span>
<span id="cb16-756"><a href="#cb16-756" aria-hidden="true" tabindex="-1"></a>breaks_eff <span class="ot">&lt;-</span> <span class="fu">seq</span>(xlim_eff[<span class="dv">1</span>], xlim_eff[<span class="dv">2</span>], <span class="at">by =</span> bw_eff)</span>
<span id="cb16-757"><a href="#cb16-757" aria-hidden="true" tabindex="-1"></a>breaks_var <span class="ot">&lt;-</span> <span class="fu">seq</span>(xlim_var[<span class="dv">1</span>], xlim_var[<span class="dv">2</span>], <span class="at">by =</span> bw_var)</span>
<span id="cb16-758"><a href="#cb16-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-759"><a href="#cb16-759" aria-hidden="true" tabindex="-1"></a>ymax_eff <span class="ot">&lt;-</span> <span class="fu">max</span>(</span>
<span id="cb16-760"><a href="#cb16-760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnRR,  <span class="at">breaks =</span> breaks_eff, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb16-761"><a href="#cb16-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnVR,  <span class="at">breaks =</span> breaks_eff, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb16-762"><a href="#cb16-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnCVR, <span class="at">breaks =</span> breaks_eff, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb16-763"><a href="#cb16-763" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb16-764"><a href="#cb16-764" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-765"><a href="#cb16-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-766"><a href="#cb16-766" aria-hidden="true" tabindex="-1"></a>ymax_var <span class="ot">&lt;-</span> <span class="fu">max</span>(</span>
<span id="cb16-767"><a href="#cb16-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnRR_var,  <span class="at">breaks =</span> breaks_var, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb16-768"><a href="#cb16-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnVR_var,  <span class="at">breaks =</span> breaks_var, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb16-769"><a href="#cb16-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(db_es<span class="sc">$</span>lnCVR_var, <span class="at">breaks =</span> breaks_var, <span class="at">plot =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>counts,</span>
<span id="cb16-770"><a href="#cb16-770" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb16-771"><a href="#cb16-771" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-772"><a href="#cb16-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-773"><a href="#cb16-773" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4) Plot helper (standardized x/y) ---</span></span>
<span id="cb16-774"><a href="#cb16-774" aria-hidden="true" tabindex="-1"></a>plot_hist <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var, title, bw, xlim, ymax) {</span>
<span id="cb16-775"><a href="#cb16-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> {{ var }})) <span class="sc">+</span></span>
<span id="cb16-776"><a href="#cb16-776" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> bw, <span class="at">boundary =</span> xlim[<span class="dv">1</span>], <span class="at">closed =</span> <span class="st">"left"</span>) <span class="sc">+</span></span>
<span id="cb16-777"><a href="#cb16-777" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> xlim, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, ymax)) <span class="sc">+</span></span>
<span id="cb16-778"><a href="#cb16-778" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">x =</span> title, <span class="at">y =</span> <span class="st">"Count"</span>)</span>
<span id="cb16-779"><a href="#cb16-779" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-780"><a href="#cb16-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-781"><a href="#cb16-781" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5) Effect-size histograms (shared axes) ---</span></span>
<span id="cb16-782"><a href="#cb16-782" aria-hidden="true" tabindex="-1"></a>p_lnRR   <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnRR,   <span class="st">"lnRR"</span>,   bw_eff, xlim_eff, ymax_eff)</span>
<span id="cb16-783"><a href="#cb16-783" aria-hidden="true" tabindex="-1"></a>p_lnVR   <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnVR,   <span class="st">"lnVR"</span>,   bw_eff, xlim_eff, ymax_eff)</span>
<span id="cb16-784"><a href="#cb16-784" aria-hidden="true" tabindex="-1"></a>p_lnCVR  <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnCVR,  <span class="st">"lnCVR"</span>,  bw_eff, xlim_eff, ymax_eff)</span>
<span id="cb16-785"><a href="#cb16-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-786"><a href="#cb16-786" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6) Sampling-variance histograms (shared axes) ---</span></span>
<span id="cb16-787"><a href="#cb16-787" aria-hidden="true" tabindex="-1"></a>p_lnRR_v  <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnRR_var,  <span class="st">"lnRR_var"</span>,  bw_var, xlim_var, ymax_var)</span>
<span id="cb16-788"><a href="#cb16-788" aria-hidden="true" tabindex="-1"></a>p_lnVR_v  <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnVR_var,  <span class="st">"lnVR_var"</span>,  bw_var, xlim_var, ymax_var)</span>
<span id="cb16-789"><a href="#cb16-789" aria-hidden="true" tabindex="-1"></a>p_lnCVR_v <span class="ot">&lt;-</span> <span class="fu">plot_hist</span>(db_es, lnCVR_var, <span class="st">"lnCVR_var"</span>, bw_var, xlim_var, ymax_var)</span>
<span id="cb16-790"><a href="#cb16-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-791"><a href="#cb16-791" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 7) Arrange (3 rows × 2 columns) ---</span></span>
<span id="cb16-792"><a href="#cb16-792" aria-hidden="true" tabindex="-1"></a>(p_lnRR <span class="sc">|</span> p_lnRR_v) <span class="sc">/</span></span>
<span id="cb16-793"><a href="#cb16-793" aria-hidden="true" tabindex="-1"></a>(p_lnVR <span class="sc">|</span> p_lnVR_v) <span class="sc">/</span></span>
<span id="cb16-794"><a href="#cb16-794" aria-hidden="true" tabindex="-1"></a>(p_lnCVR <span class="sc">|</span> p_lnCVR_v)</span>
<span id="cb16-795"><a href="#cb16-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-796"><a href="#cb16-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb16-797"><a href="#cb16-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-798"><a href="#cb16-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-799"><a href="#cb16-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-800"><a href="#cb16-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-801"><a href="#cb16-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-802"><a href="#cb16-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-803"><a href="#cb16-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-804"><a href="#cb16-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-805"><a href="#cb16-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-806"><a href="#cb16-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-807"><a href="#cb16-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-808"><a href="#cb16-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-809"><a href="#cb16-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-810"><a href="#cb16-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-811"><a href="#cb16-811" aria-hidden="true" tabindex="-1"></a></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>