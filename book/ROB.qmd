---
title: "ROB"
---



```{r}
library(dplyr)
library(here)


db <- readr::read_csv(here("..","data","db251124.csv")) 




# 1. Define the columns to check
reporting_cols <- c("Stimulus_reporting", "Control_stimulus_reporting", "Timing_reporting", 
                    "ROB_guideline", "ROB_guideline_name", "ROB_blinding", 
                    "ROB_randomization", "ROB_attrition", "ROB_selective_reporting")

# 2. Calculate reporting per study
study_level_stats <- db %>%
  group_by(Study_ID) %>%
  summarise(
    across(
      all_of(reporting_cols), 
      # Returns 1 if ANY row for this study contains "1" or "Yes", otherwise 0
      ~ if_else(any(as.character(.x) %in% c("1", "Yes", "yes", "YES"), na.rm = TRUE), 1, 0)
    )
  )

# 3. Calculate the final proportion across unique studies
final_proportions <- study_level_stats %>%
  summarise(across(all_of(reporting_cols), mean)) %>%
  tidyr::pivot_longer(everything(), names_to = "Variable", values_to = "Proportion") %>%
  mutate(Percentage = scales::percent(Proportion, accuracy = 0.1))

print(final_proportions)
```

