---
title: "overall_effect_lnVR"
---
We fit a multilevel intercept-only model for $ln VR$ to estimate the overall change in behavioral variability under music exposure. We use the same multilevel structure as for $ln RR$ and account for correlated sampling errors among effect sizes derived from the same cohort using a varianceâ€“covariance matrix  with $rho = 0.5$.



$$
\begin{equation}
\ln VR = \ln\left(\frac{SD_T}{SD_C}\right) +
\frac{1}{2}\left(\frac{1}{N_T-1}-\frac{1}{N_C-1}\right).
\end{equation}
$$

where $SD_T$ and $SD_C$ are the standard deviations of the treatment (music-exposed) and control groups, respectively.



```{r}
#| label: setup
#| include: false
pacman::p_load(
               DT,
               dtplyr,
               here, 
               knitr,
               tidyverse,
               patchwork,
               metafor,
               orchaRd
               )


db <- readr::read_csv(here("..","data","db_lnVR.csv")) %>%
  mutate(across(c(C_n, Ex_n, C_mean, Ex_mean, C_SE, Ex_SE, C_SD, Ex_SD, lnVR, lnVR_var), as.numeric)) %>%
  mutate(across(where(is.character), as.factor)) 


# CALCULATE VCV USING lnVR VARIANCE
VCV <- metafor::vcalc(
  vi = lnVR_var,       
  cluster = Cohort_ID, # The clustering variable (Study_ID + Ex_ID)
  obs = ES_ID,         # The unique observation/effect size ID
  rho = 0.5,           # Assumed correlation between outcomes from the same cohort
  data = db 
)

```

```{r}
#| label: model_overall

mOV <- rma.mv(yi = lnVR, 
                  V = VCV, 
              mods = ~ 1,
                  random = list(~1 | Study_ID,
                                ~1 | ES_ID,
                                ~1 | Strain),
                  test = "t",
                  method = "REML", 
                  sparse = TRUE,
                  data = db)

summary(mOV)
```

```{r}
#| label: i2_extraction
orchaRd::i2_ml(mOV)
```



```{r}
#| label: orchard_overall
#| fig-width: 6
#| fig-height: 4
#| warning: false
orchard_overall<-orchard_plot(mOV,
               group = "Study_ID",
               xlab = "lnVR", 
              flip = FALSE) +
            scale_colour_brewer(palette = "Set1") +
            scale_fill_brewer(palette = "Dark2")+scale_y_continuous(limits = c(-6,11),breaks = seq(-6, 10, by = 2),
                                                                    minor_breaks = seq(-6, 11, by = 1 ))
orchard_overall
```

::: callout-note
```{r}
sessionInfo()
```
:::






